<link rel="import" href="../../bower_components/polymer/polymer.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html?v=8.0.0-4"><link rel="import" href="../../bower_components/lite-signal/lite-signal.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-tabs/paper-tab.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-language-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/collection-helpers.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/access-helpers.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-logged-in-user-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-news-tab-selected.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-detect-old-ios.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-goto-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-theme/yp-theme-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-community/yp-community-collection-behaviors.html?v=8.0.0-4"><link rel="import" href="../ac-activities/ac-activities.html?v=8.0.0-4"><link rel="import" href="../yp-ajax/yp-ajax.html?v=8.0.0-4"><link rel="import" href="../yp-page/yp-page.html?v=8.0.0-4"><link rel="import" href="../yp-community/yp-community-grid.html?v=8.0.0-4"><link rel="import" href="yp-domain-large-card.html?v=8.0.0-4"><dom-module id="yp-domain"><template><style include="iron-flex iron-flex-alignment">ac-activities{@apply --layout-vertical;@apply --layout-flex;}.card-container{@apply --layout-horizontal;@apply --layout-wrap;}.card{padding:16px}@media (max-width:330px){.card{padding-left:0;padding-right:0;padding-bottom:8px;padding-top:8px}.card-container{padding:0;margin:0}}yp-ajax{background-color:var(--primary-background-color)}.twitterFeed{margin-top:24px}.archivedText{font-size:26px;color:#333}.ypBottomContainer{@apply --layout-horizontal;@apply --layout-center-center;}:host{display:block}.minHeightSection{min-height:450px}#paper_tabs[apple]{margin-top:42px;margin-bottom:8px}</style><yp-page id="page" create-fab-icon="[[createFabIcon]]" create-fab-title="[[t('community.add')]]" on-yp-create-fab-tap="_newCommunity"><yp-domain-large-card id="domainCard" slot="largeCard" class="largeCard card" domain="[[domain]]" on-update-domain="_refreshAjax"></yp-domain-large-card><paper-tabs id="paper_tabs" apple$="[[isOldiOs]]" slot="tabs" class="tabs" selected="{{selectedTab}}" attr-for-selected="name" focused=""><paper-tab name="communities" class="tab"><span>[[t('communities')]]</span> &nbsp; (<span>[[communitiesLength]]</span>)</paper-tab><paper-tab name="news" class="tab">[[t('news')]]</paper-tab></paper-tabs><iron-pages class="tabPages" fullbleed="" slot="tabPages" selected="{{selectedTab}}" attr-for-selected="name" entry-animation="fade-in-animation" exit-animation="fade-out-animation"><section name="communities" class="layout vertical"><div class="card-container layout center-center wrap"><yp-community-grid featured-communities="[[featuredCommunities]]" active-communities="[[activeCommunities]]" archived-communities="[[archivedCommunities]]" hide-add$="[[!createFabIcon]]" on-add-new-community="_newCommunity"></yp-community-grid></div></section><section name="news" class="minHeightSection"><template is="dom-if" if="[[newsTabSelected]]"><ac-activities id="domainNews" selected-tab="[[selectedTab]]" domain-id="[[domain.id]]"></ac-activities></template></section></iron-pages></yp-page><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-logged-in="_userLoggedIn"></lite-signal><app-route route="{{idRoute}}" pattern="/:id" data="{{idRouteData}}" tail="{{tabRoute}}"></app-route><app-route route="{{tabRoute}}" pattern="/:tabName" data="{{tabRouteData}}"></app-route><div class="ypBottomContainer"><yp-ajax id="ajax" url="[[url]]" on-response="_response"></yp-ajax><yp-ajax id="pagesAjax" on-response="_pagesResponse"></yp-ajax></div></template><script>Polymer({is:"yp-domain",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypThemeBehavior,Polymer.CommunityCollectionBehaviors,Polymer.CollectionHelpers,Polymer.AccessHelpers,Polymer.YpNewsTabSelected,Polymer.ypLoggedInUserBehavior,Polymer.ypDetectOldiOs,Polymer.ypGotoBehavior],properties:{idRoute:Object,tabRoute:Object,idRouteData:Object,tabRouteData:Object,createFabIcon:{type:String,value:null,notify:!0},domainId:{type:Number,value:null,observer:"_domainIdChanged"},url:{type:String},domainEmpty:{type:Boolean,value:!1},domain:{type:Object},selectedTab:{type:String,value:"communities",observer:"_selectedTabChanged"},otherSocialMediaActive:{type:Boolean,value:!1},isOldiOs:{type:Boolean,computed:"_isOldiOs(domainId)"}},observers:["_routeIdChanged(idRouteData.id)","_routeTabChanged(tabRouteData.tabName)"],listeners:{"yp-new-community":"_newCommunity"},_userLoggedIn:function(e){e&&this.domain&&window.location.href.indexOf("/domain/")>-1&&this.$.ajax.generateRequest()},_routeIdChanged:function(e){e&&this.set("domainId",e)},_routeTabChanged:function(e){e&&this.set("selectedTab",e)},_selectedTabChanged:function(e){"other_social_media"==e?this.set("otherSocialMediaActive",!0):this.set("otherSocialMediaActive",!1),this.domain&&this.redirectTo("/domain/"+this.domain.id+"/"+e),e&&window.appGlobals&&window.appGlobals.activity("open","domain_tab_"+e),this.async(function(){var e=this.$$("#domainNews");e&&e.fireResize()},300)},_domainIdChanged:function(e,i){e&&(this.set("featuredCommunities",null),this.set("activeCommunities",null),this.set("archivedCommunities",null),this.$.ajax.url="/api/domains/"+this.domainId,this.$.ajax.generateRequest())},_refreshAjax:function(){this.$.ajax.generateRequest()},_newCommunity:function(){window.appGlobals.activity("open","newCommunity"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("communityEdit",function(e){e.setup(null,!0,this._refreshAjax.bind(this)),e.open("new",{domainId:this.domainId})}.bind(this))},_pagesResponse:function(e,i){this.fire("yp-set-pages",i.response)},_response:function(e,i,t){console.log("Got domain response: "+i.response.id),this.set("domain",i.response),window.appGlobals.domain=this.domain,this.refresh(),this.domain.only_admins_can_create_communities&&!this.checkDomainAccess(this.domain)||this.set("createFabIcon","group-work"),window.appGlobals.setupGoogleAnalytics(this.domain),this.domain.Communities&&this.setupCommunities(__.dropRight(this.domain.Communities,this.domain.Communities.length-500)),this.$.domainCard.setElevation(5),this.$.domainCard.lowerCardLater()},refresh:function(){this.domain&&(null!=this.domain.default_locale&&window.appGlobals.changeLocaleIfNeeded(this.domain.default_locale),null!=this.domain.theme_id&&this.setTheme(this.domain.theme_id),this.fire("yp-set-home-link",{type:"domain",id:this.domain.id,name:this.domain.name}),this.fire("change-header",{headerTitle:null,documentTitle:this.domain.name,headerDescription:this.domain.description}),this.domain.DomainHeaderImages&&this.domain.DomainHeaderImages.length>0?this.$.page.setupTopHeaderImage(this.domain.DomainHeaderImages):this.$.page.setupTopHeaderImage(null),this.$.pagesAjax.url="/api/domains/"+this.domain.id+"/pages",this.$.pagesAjax.generateRequest()),window.appGlobals.setAnonymousGroupStatus(null),window.appGlobals.disableFacebookLoginForGroup=!1,window.appGlobals.externalGoalTriggerUrl=null,window.appGlobals.currentGroupForceSaml=!1}});</script></dom-module>