<div hidden="" by-polymer-bundler=""><dom-module id="yp-post-header"><template><style include="iron-flex iron-flex-alignment">:host{display:block}.infoContainer{@apply --layout-vertical;color:var(--primary-color-more-darker,#252525);line-height:var(--description-line-height,1.3);width:540px;padding:0;padding-bottom:16px;padding-top:16px}.voting{@apply --layout-horizontal;@apply --layout-center;text-align:center;padding-left:16px;padding-right:24px}yp-post-actions{position:absolute;right:8px;bottom:0}.edit{color:#eee;position:absolute;top:0;right:0;padding-right:0;margin-right:0}.post-name{margin:0;font-size:var(--extra-large-heading-size,28px);background-color:var(--primary-color-600);color:#FFF;padding:16px;cursor:pointer;font-weight:700;min-height:33px}.category-icon{width:100px;height:100px}.category-image-container{text-align:right;margin-top:-52px}.postCardCursor{cursor:pointer}yp-post-cover-media{position:relative;width:420px;height:236px}yp-post-cover-media[audio-cover]{height:90px}.transcriptContainer{width:420px;max-width:420px}.postCard{width:960px;background-color:#fff;@apply --layout-horizontal;position:relative}.description{padding-bottom:2px;padding-left:8px;padding-right:8px;margin-bottom:42px}paper-icon-button.moreVert{position:absolute;top:0;right:0}.userInfo{color:#ddd;font-size:17px}@media (max-width:960px){:host{max-width:600px}.postCard{width:100%;@apply --layout-wrap;}yp-post-cover-media{width:100%!important}.coverContainer{width:100%}.transcriptContainer{width:100%;max-width:100%}.voting{padding-left:0;padding-right:0}.card-actions{left:24px;right:0;width:320px}.card-content{width:100%!important;padding-bottom:16px}.infoContainer{width:100%}.description[no-user-info]{padding-bottom:32px}.description{margin-bottom:8px}.userInfo{font-size:14px}.mediaAndInfoContainer{@apply --layout-center-center;}}@media (max-width:800px){.post-name{font-size:22px;min-height:21px}}@media (max-width:430px){:host{width:100%}.postCard{width:100%!important;margin:8px;margin-top:4px}yp-post-cover-media{height:225px}.card-actions{left:0;width:280px}.post-name{font-size:18px}.post-name[logged-in]{padding-right:24px}.headerTopLevel{width:100%}.description{padding-bottom:32px;font-size:15px}}@media (max-width:375px){yp-post-cover-media[header-mode]{height:205px}yp-post-cover-media[audio-cover]{height:80px}}@media (max-width:360px){yp-post-cover-media[header-mode]{height:200px}yp-post-cover-media[audio-cover]{height:90px}}@media (max-width:320px){yp-post-cover-media[header-mode]{height:180px}yp-post-cover-media[audio-cover]{height:90px}}.userWithOrg{--ak-user-name-color:#555555}[hidden]{display:none!important}#postTranscriptionEditor{padding-left:8px;padding-right:8px}.transcriptError{margin-top:8px;color:red}paper-spinner{margin-top:8px}.checkTranscript{margin-top:8px;padding:8px}.transcriptText{margin-top:0;padding:8px;color:#444;padding-bottom:0;font-style:italic;margin-bottom:8px}.transcriptHeader{color:#222;margin-bottom:2px;font-style:normal}.editIcon{color:#656565}@media (min-width:960px){yp-post-cover-media[has-transcript][audio-cover]{margin-bottom:16px}}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-logged-in="_userLoggedIn"></lite-signal><div class="layout horizontal center-center"><paper-material class="postCard" elevation="[[elevation]]" animated=""><div class="layout vertical headerTopLevel"><div class="post-name layout vertical" on-tap="goToPostIfNotHeader" logged-in$="[[loggedInUser]]"><div><yp-magic-text text-type="postName" content-language="[[post.language]]" content="[[postName]]" content-id="[[post.id]]"></yp-magic-text></div><template is="dom-if" if="[[post.Group.configuration.showWhoPostedPosts]]"><div class="layout horizontal userInfo"><yp-user-with-organization class="userWithOrg" hide-image="" title-date="[[post.user.name]]" user$="[[post.User]]"></yp-user-with-organization></div></template></div><div class="layout horizontal wrap mediaAndInfoContainer"><div class="layout vertical center-center self-start coverContainer"><yp-post-cover-media show-video="" show-audio="" has-transcript$="[[post.public_data.transcript.text]]" audio-cover$="[[isAudioCover]]" header-mode$="[[headerMode]]" post="[[post]]"></yp-post-cover-media><div class="transcriptContainer"><template is="dom-if" if="[[checkingTranscript]]"><div class="layout vertical center-center checkTranscript"><div>[[t('checkingForTranscript')]]</div><paper-spinner active=""></paper-spinner></div></template><div class="transcriptError layout horizontal center-center" hidden$="[[!checkTranscriptError]]">[[t('checkTranscriptError')]]</div><template is="dom-if" if="[[post.public_data.transcript.text]]"><div class="transcriptText layout vertical center-center"><div class="transcriptHeader" hidden$="[[post.public_data.transcript.noMachineTranslation]]">[[t('automaticTranscript')]] <span hidden$="[[!post.public_data.transcript.userEdited]]">([[t('edited')]])</span></div><div id="postContentTranscript" hidden$="[[isEditing]]" on-tap="_linkIfNeeded"><yp-magic-text text-type="postTranscriptContent" content-language="[[post.public_data.transcript.language]]" content="[[post.public_data.transcript.text]]" content-id="[[post.id]]"></yp-magic-text></div><template is="dom-if" if="[[hasPostAccess]]"><div class="layout horizontal" hidden$="[[isEditing]]"><div class="flex"></div><yp-ajax id="editPostTranscriptAjax" method="PUT" on-response="_editPostTranscriptResponse"></yp-ajax><paper-icon-button class="editIcon" title$="[[t('edit')]]" icon="create" on-tap="_editPostTranscript"></paper-icon-button></div></template></div></template><template is="dom-if" if="[[isEditing]]" restamp=""><div class="layout vertical" hidden$="[[!hasPostAccess]]"><paper-textarea id="postTranscriptionEditor" char-counter="" maxlength="500" value="{{editText}}"></paper-textarea><div class="horizontal end-justified layout"><emoji-selector id="postTranscriptEmojiSelector"></emoji-selector></div><div class="layout horizontal self-end"><paper-button on-tap="_cancelEdit">[[t('cancel')]]</paper-button><paper-button on-tap="_saveEdit">[[t('update')]]</paper-button></div></div></template><yp-ajax hidden="" id="checkTranscriptStatusAjax" on-response="_transcriptStatusResponse"></yp-ajax></div></div><div class="layout vertical"><div class="infoContainer"><yp-magic-text id="description" text-type="postContent" content-language="[[post.language]]" content="[[post.description]]" no-user-info$="[[!post.Group.configuration.showWhoPostedPosts]]" content-id="[[post.id]]" class="description" truncate="500" more-text="{{t('readMore')}}" close-dialog-text="[[t('close')]]"></yp-magic-text></div><div class="card-actions"><yp-post-actions floating="" header-mode="[[headerMode]]" elevation="-1" endorse-mode="[[endorseMode]]" class="voting" post="[[post]]"></yp-post-actions></div></div><template is="dom-if" if="[[headerMode]]"><template is="dom-if" if="[[loggedInUser]]"><paper-menu-button vertical-align="top" horizontal-align="right" class="edit"><paper-icon-button class="moreVert" icon="more-vert" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content" on-iron-select="_menuSelection"><template is="dom-if" if="[[hasPostAccess]]"><paper-item id="editMenuItem">[[t('post.edit')]]</paper-item><paper-item id="moveMenuItem">[[t('post.move')]]</paper-item><paper-item hidden$="[[!checkPostAdminOnlyAccess(post)]]" id="statusChangeMenuItem">[[t('post.statusChange')]]</paper-item><paper-item id="deleteMenuItem">[[t('post.delete')]]</paper-item><paper-item hidden$="[[!checkPostAdminOnlyAccess(post)]]" id="anonymizeMenuItem">[[t('anonymizePostAndContent')]]</paper-item><paper-item hidden$="[[!checkPostAdminOnlyAccess(post)]]" id="deleteContentMenuItem">[[t('deletePostContent')]]</paper-item></template><paper-item id="reportMenuItem">[[t('post.report')]]</paper-item></paper-listbox></paper-menu-button></template></template></div></div></paper-material></div><lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal></template><script>Polymer({is:"yp-post-header",behaviors:[Polymer.ypLanguageBehavior,Polymer.YpPostBehavior,Polymer.AccessHelpers,Polymer.ypGotAdminRightsBehavior,Polymer.ypLoggedInUserBehavior,Polymer.ypGotoBehavior,Polymer.ypTruncateBehavior,Polymer.ypMediaFormatsBehavior],properties:{selectedMenuItem:{type:String},headerMode:{type:Boolean,value:!1},elevation:{type:Number,value:2},post:{type:Object,observer:"_postChanged"},hasPostAccess:{type:Boolean,value:!1,notify:!0,computed:"_hasPostAccess(post, gotAdminRights)"},isEditing:{type:Boolean,value:!1,observer:"_isEditingChanged"},editText:String,checkingTranscript:{type:Boolean,value:!1},checkTranscriptError:{type:Boolean,value:!1},isAudioCover:{type:Boolean,value:!1}},_isEditingChanged:function(t){this._updateEmojiBindings(t),this.async(function(){this.fire("iron-resize")})},_updateEmojiBindings:function(t){t&&this.async(function(){var t=this.$$("#postTranscriptionEditor"),e=this.$$("#postTranscriptEmojiSelector");t&&e?e.inputTarget=t:console.error("Wide: Can't bind post edit emojis :(")}.bind(this),500)},_cancelEdit:function(){this.set("isEditing",!1)},_saveEdit:function(){this.$$("#editPostTranscriptAjax").url="/api/posts/"+this.post.id+"/editTranscript",this.$$("#editPostTranscriptAjax").body={content:this.editText},this.$$("#editPostTranscriptAjax").generateRequest()},_editPostTranscriptResponse:function(t,e){this.set("post.public_data.transcript.text",this.editText),this.set("post.public_data.transcript.userEdited",!0),this.set("isEditing",!1)},_editPostTranscript:function(){this.hasPostAccess&&(this.set("editText",this.post.public_data.transcript.text),this.set("isEditing",!0))},_transcriptStatusResponse:function(t,e){e.response&&e.response.text?(this.set("post.public_data.transcript.text",e.response.text),this.hasPostAccess&&(this.set("editText",e.response.text),this.set("isEditing",!0)),this.set("checkingTranscript",!1),this.async(function(){this.fire("iron-resize")})):e.response&&e.response.inProgress?this.async(function(){this.$$("#checkTranscriptStatusAjax").generateRequest()},2e3):e.response&&e.response.error?(this.set("checkingTranscript",!1),this.set("checkTranscriptError",!0)):this.set("checkingTranscript",!1)},_hasPostAccess:function(t,e){return!(!t||!e)&&null!=this.checkPostAccess(t)},goToPostIfNotHeader:function(){this.headerMode||this.goToPost()},_postChanged:function(t){t&&t.description&&(this.async(function(){var e=this.$$("#description");e?t.data&&"lawIssue"===t.data.dataType&&t.data.issueStatus&&(e.content+=" - "+t.data.issueStatus):console.error("Can't find description element")}),this.hasPostAccess&&!0===window.appGlobals.hasTranscriptSupport&&t.public_data&&t.public_data.transcript&&t.public_data.transcript.inProgress&&("audio"===t.cover_media_type?(this.$$("#checkTranscriptStatusAjax").url="/api/posts/"+t.id+"/audioTranscriptStatus",this.$$("#checkTranscriptStatusAjax").generateRequest(),this.set("checkingTranscript",!0)):"video"===t.cover_media_type&&(this.$$("#checkTranscriptStatusAjax").url="/api/posts/"+t.id+"/videoTranscriptStatus",this.$$("#checkTranscriptStatusAjax").generateRequest(),this.set("checkingTranscript",!0)))),t&&("audio"===t.cover_media_type?this.set("isAudioCover",!0):this.set("isAudioCover",!1)),this.set("checkTranscriptError",!1)},updateDescriptionIfEmpty:function(t){this.post.description&&""!=this.post.description||this.set("post.description",t)},_refresh:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("postEdit",function(t){t.selected=0,this.fire("refresh")}.bind(this))},_menuSelection:function(t,e){"editMenuItem"==e.item.id?this._openEdit():"deleteMenuItem"==e.item.id?this._openDelete():"statusChangeMenuItem"==e.item.id?this._openPostStatusChange():"moveMenuItem"==e.item.id?this._openMovePost():"anonymizeMenuItem"==e.item.id?this._openAnonymizeContent():"deleteContentMenuItem"==e.item.id&&this._openDeleteContent(),this.$$("paper-listbox").select(null)},_openMovePost:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("postMove",function(t){t.setupAndOpen(this.post,this._refresh.bind(this))}.bind(this))},_openPostStatusChange:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("postStatusChangeEdit",function(t){t.setup(this.post,null,this._refresh.bind(this)),t.open("new",{postId:this.post.id,statusChange:!0})}.bind(this))},_openEdit:function(){window.appGlobals.activity("open","post.edit"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("postEdit",function(t){t.setup(this.post,!1,this._refresh.bind(this),this.post.Group),t.open("edit",{postId:this.post.id})}.bind(this))},_openReport:function(){window.appGlobals.activity("open","post.report"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(t){t.setup("/api/posts/"+this.post.id+"/report",this.t("reportConfirmation"),this._onReport.bind(this),this.t("post.report"),"PUT"),t.open()}.bind(this))},_openDelete:function(){window.appGlobals.activity("open","post.delete"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(t){t.setup("/api/posts/"+this.post.id,this.t("post.deleteConfirmation"),this._onDeleted.bind(this)),t.open()}.bind(this))},_openDeleteContent:function(){window.appGlobals.activity("open","postDeleteContent"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(t){t.setup("/api/posts/"+this.post.id+"/delete_content",this.t("postDeleteContentConfirmation")),t.open()}.bind(this))},_openAnonymizeContent:function(){window.appGlobals.activity("open","postAnonymizeContent"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(t){t.setup("/api/posts/"+this.post.id+"/anonymize_content",this.t("postAnonymizeContentConfirmation")),t.open()}.bind(this))},_onReport:function(){window.appGlobals.notifyUserViaToast(this.t("post.report")+": "+this.post.name)},_onDeleted:function(){this.dispatchEvent(new CustomEvent("yp-refresh-group",{bubbles:!0,composed:!0})),this.redirectTo("/group/"+this.post.group_id)}});</script></dom-module><dom-module id="yp-post-points"><template><style include="iron-flex iron-flex-alignment">:host {
        display: block;
      }

      .item {
        @apply --layout-horizontal;
      }

      .main-container {
        @apply --layout-horizontal;
        background-color: var(--primary-background-color);
      }

      .point {
        padding-top: 32px;
        padding-bottom: 32px;
        padding-left: 24px;
        padding-right: 24px;
        @apply --layout-vertical;
        width: 398px;
      }

      .pointInputMaterial {
        padding-top: 24px;
        padding-bottom: 16px;
        padding-left: 16px;
        padding-right: 16px;
        margin-bottom: 16px;
        background-color: #FFF;
      }

      paper-toast {
        z-index: 9999;
      }

      paper-material {
        background-color: #fff;
      }

      yp-point {
        padding-top: 8px;
      }

      .pointMaterial {
        padding-top: 8px;
        background-color: #FFF;
        padding-left: 0;
        padding-right: 0;
        width: 430px;
        margin-bottom: 12px;
      }

      .thumbIcon {
        height: 64px;
        width: 64px;
        padding-bottom: 16px;
        color: var(--primary-color);
      }

      .editIcon {
        height: 28px;
        width: 28px;
        padding-bottom: 16px;
        color: var(--primary-color);
      }

      .addPointFab {
        width: 100%;
        color: #FFF;
      }

      paper-textarea {
        --paper-input-container-label: {
          font-size: 26px;
          height: 42px;
          overflow: visible;
          color: #AAAAAA;
        }
      }

      .howToWriteInfoText {
        padding-top: 4px;
        color: var(--primary-color);
      }

      .point .main-container .topContainer {
        background-color: var(--primary-background-color) !important;
      }

      .penContainer {
        margin-top: 42px;
      }

      .upOrDown {
        margin-top: 72px;
      }

      paper-radio-button {
        --paper-radio-button-checked-color: var(--accent-color) !important;
        font-size: 16px;
      }

      #pointUpOrDownMaterial {
        margin-top: 16px;
        width: 100%;
      }

      .mobileFab {
        margin-top: 8px;
      }

      paper-button {
        color: #FFF;
        background-color: var(--accent-color);
      }

      @media (max-width: 985px) {
        .pointInputMaterial {
          width: 91vw !important;
          max-width: 500px;
          font-size: 14px;
          padding-top: 4px;
        }

        .pointMaterial {
          width: 100%;
        }

        .main-container {
          width: 100%;
        }

        iron-list {
          width: 100vw;
        }

        .pointMaterial {
        }
      }

      .mobilePaperTextArea {
        --paper-input-container-label: {
          font-size: 19px;
        };
      }

      .pointMainHeader {
        font-size: 26px;
        margin-bottom: 16px;
        color: #555;
      }

      #pointUpMaterialNotUsed {
        border-top: solid 2px;
        border-top-color:  var(--master-point-up-color);
      }

      #pointDownMaterialNotUsed {
        border-top: solid 2px;
        border-top-color: var(--master-point-down-color);
      }

      .pointElement {
        margin-bottom: 18px;
      }

      [hidden] {
        display: none !important;
      }

      iron-list {
        height: 80vh;
      }

      iron-list {
        --iron-list-items-container: {
        };
      }

      :focus {
        outline: none;
      }

      #ironListMobile[debate-disabled] {
        margin-top: 16px;
      }

      .mainSpinner {
        margin: 32px;
      }

      paper-button[disabled] {
        background-color: #333;
        color: #FFF;
      }

      .videoInfo {
        margin-top: 8px;
        margin-bottom: 14px;
        color: #656565;
        @apply --layout-self-start;
      }

      .uploadNotLoggedIn {
        width: 100px;
        background-color: #FFF;
        color: #000;
      }

      .pointButtons {
        margin-bottom: 4px;
      }

      .bottomDiv {
        margin-bottom: 64px;
      }

      .uploadSection {
        justify-content: space-evenly;
        width: 50%;
        margin-left: 8px;
        margin-right: 8px;
        vertical-align: top;
      }</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-yp-update-points-for-post="_loadNewPointsIfNeeded"></lite-signal><lite-signal on-lite-signal-logged-in="_userLoggedIn"></lite-signal><iron-media-query query="(min-width: 985px)" query-matches="{{largeMode}}"></iron-media-query><div class="layout horizontal center-center" hidden$="[[ajaxActive]]"><yp-ajax id="ajax" large-spinner="" active$="{{ajaxActive}}" on-response="_response"></yp-ajax></div><template is="dom-if" if="[[largeMode]]" restamp=""><div class="layout vertical topContainer"><div class="main-container"><div class="point"><template is="dom-if" if="[[!post.Group.configuration.alternativePointForHeader]]"><div class="pointMainHeader layout horizontal center-center">[[t('pointsFor')]]</div></template><template is="dom-if" if="[[post.Group.configuration.alternativePointForHeader]]"><div class="pointMainHeader layout horizontal center-center">[[post.Group.configuration.alternativePointForHeader]]</div></template><paper-material id="pointUpMaterial" elevation="1" class="pointInputMaterial layout vertical" animated="" hidden$="[[post.Group.configuration.disableDebate]]"><paper-textarea id="up_point" on-tap="focusUpPoint" on-focus="focusTextArea" on-blur="blurTextArea" value="{{textValueUp}}" label$="[[labelUp]]" char-counter="" rows="2" hidden$="[[hideUpText]]" max-rows="3" maxlength="500"></paper-textarea><div class="horizontal end-justified layout" hidden$="[[post.Group.configuration.hideEmoji]]"><emoji-selector id="pointUpEmojiSelector" hidden$="[[hideUpText]]"></emoji-selector></div><div class="layout horizontal center-justified"><template is="dom-if" if="[[post.Group.configuration.allowPointVideoUploads]]"><div hidden$="[[hideUpVideo]]" class="uploadSection"><div class="layout vertical center-center self-start" hidden$="[[!loggedInUser]]"><yp-file-upload id="videoFileUploadUp" current-file="{{hasCurrentUpVideo}}" container-type="points" group="[[post.Group]]" raised="true" multi="false" video-upload="" method="POST" on-success="_videoUpUploaded"><iron-icon class="icon" icon="videocam"></iron-icon><span>[[t('uploadVideoPointFor')]]</span></yp-file-upload><div class="videoInfo self-start">[[t('pointVideoInfo')]] <b>[[post.Group.configuration.videoPointUploadLimitSec]] [[t('seconds')]].</b></div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn" raised="" hidden$="[[loggedInUser]]" on-tap="_openLogin">[[t('uploadVideoPointFor')]]</paper-button></div></div></template><template is="dom-if" if="[[post.Group.configuration.allowPointAudioUploads]]"><div hidden$="[[hideUpAudio]]" class="uploadSection"><div class="layout vertical center-center" hidden$="[[!loggedInUser]]"><yp-file-upload id="videoAudioUploadUp" current-file="{{hasCurrentUpAudio}}" container-type="points" group="[[post.Group]]" raised="true" multi="false" audio-upload="" method="POST" on-success="_audioUpUploaded"><iron-icon class="icon" icon="keyboard-voice"></iron-icon><span>[[t('uploadAudioPointFor')]]</span></yp-file-upload><div class="videoInfo self-start">[[t('pointAudioInfo')]] <b>[[post.Group.configuration.audioPointUploadLimitSec]] [[t('seconds')]].</b> <span hidden$="[[!isAndroid]]">[[t('pointAudioInfoAndroid')]]</span></div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn" raised="" hidden$="[[loggedInUser]]" on-tap="_openLogin">[[t('uploadAudioPointFor')]]</paper-button></div></div></template></div><div hidden="[[!ifLengthUpIsRight]]"><div class="addPointFab layout horizontal center-center"><paper-button raised="" class="submitButton" disabled$="[[addPointDisabled]]" icon="add" mini="" elevation="3" on-tap="addPointUp" title="[[t('point.add_up')]]">[[t('postPoint')]]</paper-button></div></div></paper-material><div id="allUpPoints"><iron-list id="ironListUp" items="[[upPoints]]" as="point" scroll-target="document" scroll-offset="550"><template><div class="item" tabindex$="[[tabIndex]]"><paper-material id="point[[point.id]]" elevation="1" animated="" class="pointMaterial"><yp-point point="[[point]]"></yp-point></paper-material></div></template></iron-list></div></div><div class="point"><template is="dom-if" if="[[!post.Group.configuration.alternativePointAgainstHeader]]"><div class="pointMainHeader layout horizontal center-center">[[t('pointsAgainst')]]</div></template><template is="dom-if" if="[[post.Group.configuration.alternativePointAgainstHeader]]"><div class="pointMainHeader layout horizontal center-center">[[post.Group.configuration.alternativePointAgainstHeader]]</div></template><paper-material id="pointDownMaterial" elevation="1" class="pointInputMaterial layout vertical" animated="" hidden$="[[post.Group.configuration.disableDebate]]"><paper-textarea id="down_point" on-tap="focusDownPoint" on-focus="focusTextArea" on-blur="blurTextArea" value="{{textValueDown}}" label$="[[labelDown]]" char-counter="" rows="2" hidden$="[[hideDownText]]" max-rows="5" maxlength="500"></paper-textarea><div class="horizontal end-justified layout" hidden$="[[post.Group.configuration.hideEmoji]]"><emoji-selector id="pointDownEmojiSelector" hidden$="[[hideDownText]]"></emoji-selector></div><div class="layout horizontal center-justified"><template is="dom-if" if="[[post.Group.configuration.allowPointVideoUploads]]"><div hidden$="[[hideDownVideo]]" class="uploadSection"><div class="layout vertical center-center self-start" hidden$="[[!loggedInUser]]"><yp-file-upload id="videoFileUploadDown" current-file="{{hasCurrentDownVideo}}" container-type="points" group="[[post.Group]]" raised="true" multi="false" video-upload="" method="POST" on-success="_videoDownUploaded"><iron-icon class="icon" icon="videocam"></iron-icon><span>[[t('uploadVideoPointAgainst')]]</span></yp-file-upload><div class="videoInfo self-start">[[t('pointVideoInfo')]] <b>[[post.Group.configuration.videoPointUploadLimitSec]] [[t('seconds')]].</b></div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn" raised="" hidden$="[[loggedInUser]]" on-tap="_openLogin">[[t('uploadVideoPointAgainst')]]</paper-button></div></div></template><template is="dom-if" if="[[post.Group.configuration.allowPointAudioUploads]]"><div hidden$="[[hideDownAudio]]" class="uploadSection"><div class="layout vertical center-center" hidden$="[[!loggedInUser]]"><yp-file-upload id="audioFileUploadDown" current-file="{{hasCurrentDownAudio}}" container-type="points" group="[[post.Group]]" raised="true" multi="false" audio-upload="" method="POST" on-success="_audioDownUploaded"><iron-icon class="icon" icon="keyboard-voice"></iron-icon><span>[[t('uploadAudioPointAgainst')]]</span></yp-file-upload><div class="videoInfo self-start">[[t('pointAudioInfo')]] <b>[[post.Group.configuration.audioPointUploadLimitSec]] [[t('seconds')]].</b> <span hidden$="[[!isAndroid]]">[[t('pointAudioInfoAndroid')]]</span></div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn" raised="" hidden$="[[loggedInUser]]" on-tap="_openLogin">[[t('uploadAudioPointAgainst')]]</paper-button></div></div></template></div><div hidden="[[!ifLengthDownIsRight]]"><div class="addPointFab layout horizontal center-center"><paper-button raised="" disabled$="[[addPointDisabled]]" icon="add" elevation="3" on-tap="addPointDown" title="[[t('point.add_down')]]">[[t('postPoint')]]</paper-button></div></div></paper-material><div id="allDownPoints"><iron-list id="ironListDown" items="[[downPoints]]" as="point" scroll-target="document" scroll-offset="550"><template><div class="item" tabindex$="[[tabIndex]]"><paper-material id="point[[point.id]]" elevation="1" animated="" class="pointMaterial"><yp-point point="[[point]]"></yp-point></paper-material></div></template></iron-list></div></div></div></div></template><template is="dom-if" if="[[!largeMode]]" restamp=""><div class="layout vertical center-center"><paper-material id="pointUpOrDownMaterial" elevation="1" class="pointInputMaterial layout vertical" animated="" hidden$="[[post.Group.configuration.disableDebate]]"><paper-textarea id="mobileUpOrDownPoint" class="mobilePaperTextArea" on-tap="focusDownPoint" on-focus="focusTextArea" on-blur="blurTextArea" value="{{textValueMobileUpOrDown}}" label="[[labelMobileUpOrDown]]" char-counter="" rows="2" hidden$="[[hideMobileText]]" max-rows="3" maxlength="500"></paper-textarea><div class="layout vertical end-justified"><div class="layout horizontal center-center pointButtons"><paper-radio-group id="upOrDown" attribute-for-selected="name" class="layout horizontal" selected="{{pointUpOrDownSelected}}"><paper-radio-button name="pointFor">[[t('pointForShort')]]</paper-radio-button><paper-radio-button name="pointAgainst">[[t('pointAgainstShort')]]</paper-radio-button></paper-radio-group><div class="flex"></div><div hidden$="[[hideMobileText]]"><emoji-selector id="pointUpDownEmojiSelector" hidden$="[[post.Group.configuration.hideEmoji]]"></emoji-selector></div></div><div class="layout horizontal center-justified"><template is="dom-if" if="[[post.Group.configuration.allowPointVideoUploads]]"><div hidden$="[[hideMobileVideo]]" class="uploadSection"><div class="layout vertical center-center self-start" hidden$="[[!loggedInUser]]"><yp-file-upload id="videoFileUploadMobile" current-file="{{hasCurrentMobileVideo}}" container-type="points" group="[[post.Group]]" raised="true" multi="false" video-upload="" method="POST" on-success="_videoMobileUploaded"><iron-icon class="icon" icon="videocam"></iron-icon><span hidden$="[[!selectedPointForMobile]]">[[t('uploadVideoPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadVideoPointAgainst')]]</span></yp-file-upload><div class="videoInfo self-start">[[t('pointVideoInfo')]] <b>[[post.Group.configuration.videoPointUploadLimitSec]] [[t('seconds')]].</b></div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn" raised="" hidden$="[[loggedInUser]]" on-tap="_openLogin"><span hidden$="[[!selectedPointForMobile]]">[[t('uploadVideoPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadVideoPointAgainst')]]</span></paper-button></div></div></template><template is="dom-if" if="[[post.Group.configuration.allowPointAudioUploads]]"><div hidden$="[[hideMobileAudio]]" class="uploadSection"><div class="layout vertical center-center self-start" hidden$="[[!loggedInUser]]"><yp-file-upload id="audioFileUploadMobile" current-file="{{hasCurrentMobileAudio}}" container-type="points" group="[[post.Group]]" raised="true" multi="false" audio-upload="" method="POST" on-success="_audioMobileUploaded"><iron-icon class="icon" icon="keyboard-voice"></iron-icon><span hidden$="[[!selectedPointForMobile]]">[[t('uploadAudioPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadAudioPointAgainst')]]</span></yp-file-upload><div class="videoInfo self-start">[[t('pointAudioInfo')]] <b>[[post.Group.configuration.audioPointUploadLimitSec]] [[t('seconds')]].</b> <span hidden$="[[!isAndroid]]">[[t('pointAudioInfoAndroid')]]</span></div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn" raised="" hidden$="[[loggedInUser]]" on-tap="_openLogin"><span hidden$="[[!selectedPointForMobile]]">[[t('uploadAudioPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadAudioPointAgainst')]]</span></paper-button></div></div></template></div></div><div hidden="[[!ifLengthMobileRight]]"><div class="addPointFab layout horizontal center-center mobileFab"><paper-button raised="" disabled$="[[addPointDisabled]]" icon="add" elevation="3" on-tap="addMobilePointUpOrDown" title="[[t('postPoint')]]"><span hidden$="[[!selectedPointForMobile]]">[[t('postPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('postPointAgainst')]]</span></paper-button></div></div></paper-material></div><div class="layout vertical center-center"><iron-list id="ironListMobile" debate-disabled$="[[post.Group.configuration.disableDebate]]" items="[[points]]" as="point" scroll-target="document" scroll-offset="[[mobileScrollOffset]]"><template><div class="item" tabindex$="[[tabIndex]]"><paper-material id="point[[point.id]]" elevation="1" animated="" class="pointMaterial"><yp-point point="[[point]]"></yp-point></paper-material></div></template></iron-list></div></template><div class="layout vertical center-center"><yp-ajax id="newPointsAjax" on-response="_newPointsResponse"></yp-ajax><yp-ajax id="newPointAjax" on-error="_newPointError" method="POST" url="/api/points" on-response="_newPointResponse"></yp-ajax></div><paper-toast id="newPointToast" text="[[newPointTextCombined]]"></paper-toast></template><script>Polymer({is:"yp-post-points",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypTruncateBehavior,Polymer.ypLoggedInUserBehavior],properties:{host:String,downPoints:{type:Array,value:[]},upPoints:{type:Array,value:[]},textValueUp:{type:String,notify:!0,value:""},textValueDown:{type:String,notify:!0,value:""},newPointTextCombined:{type:String},post:{type:Object,observer:"_postChanged"},points:{type:Array,value:null,observer:"_pointsChanged"},largeMode:{type:Boolean,value:!1,observer:"_updateEmojiBindings"},textValueMobileUpOrDown:String,labelMobileUpOrDown:String,labelUp:String,labelDown:String,pointUpOrDownSelected:{type:String,observer:"_pointUpOrDownSelectedChanged",value:"pointFor"},latestPointCreatedAt:{type:Date,value:null},scrollToId:{type:String,value:null,observer:"_scrollToIdChanged"},ironListResizeScrollThreshold:{type:Number,computed:"_ironListResizeScrollThreshold(largeMode)"},ironListPaddingTop:{type:Number,computed:"_ironListPaddingTop(wide)"},ifLengthUpIsRight:{type:Boolean,value:!1,computed:'ifLengthIsRight("up",textValueUp, uploadedVideoUpId, uploadedAudioUpId)'},ifLengthDownIsRight:{type:Boolean,value:!1,computed:'ifLengthIsRight("down", textValueDown, uploadedVideoDownId, uploadedAudioDownId)'},ifLengthMobileRight:{type:Boolean,value:!1,computed:'ifLengthIsRight("mobile", textValueMobileUpOrDown, uploadedVideoMobileId, uploadedAudioMobileId)'},addPointDisabled:{type:Boolean,value:!1},mobileScrollOffset:{type:Number,computed:"_mobileScrollOffset(largeMode,post)"},ajaxActive:{type:Boolean,value:!1},uploadedVideoUpId:{type:String,value:null},uploadedVideoDownId:{type:String,value:null},uploadedVideoMobileId:{type:String,value:null},currentVideoId:{type:String,value:null},hideUpVideo:{type:Boolean,value:!1},hideDownVideo:{type:Boolean,value:!1},hideMobileVideo:{type:Boolean,value:!1},uploadedAudioUpId:{type:String,value:null},uploadedAudioDownId:{type:String,value:null},uploadedAudioMobileId:{type:String,value:null},currentAudioId:{type:String,value:null},hideUpAudio:{type:Boolean,value:!1},hideDownAudio:{type:Boolean,value:!1},hideMobileAudio:{type:Boolean,value:!1},hideUpText:{type:Boolean,value:!1},hideDownText:{type:Boolean,value:!1},hideMobileText:{type:Boolean,value:!1},selectedPointForMobile:{type:Boolean,value:!0},isAndroid:{type:Boolean,value:!1},hasCurrentUpVideo:{type:String,observer:"_hasCurrentUpVideo"},hasCurrentDownVideo:{type:String,observer:"_hasCurrentDownVideo"},hasCurrentMobileVideo:{type:String,observer:"_hasCurrentMobileVideo"},hasCurrentUpAudio:{type:String,observer:"_hasCurrentUpAudio"},hasCurrentDownAudio:{type:String,observer:"_hasCurrentDownAudio"},hasCurrentMobileAudio:{type:String,observer:"_hasCurrentMobileAudio"}},_openLogin:function(){this.fire("yp-open-login")},_videoUpUploaded:function(e,t){this.set("uploadedVideoUpId",t.videoId)},_videoDownUploaded:function(e,t){this.set("uploadedVideoDownId",t.videoId)},_videoMobileUploaded:function(e,t){this.set("uploadedVideoMobileId",t.videoId)},_audioUpUploaded:function(e,t){this.set("uploadedAudioUpId",t.audioId)},_audioDownUploaded:function(e,t){this.set("uploadedAudioDownId",t.audioId)},_audioMobileUploaded:function(e,t){this.set("uploadedAudioMobileId",t.audioId)},_mobileScrollOffset:function(e,t){if(!e&&t){var i=this.$$("#ironListMobile");if(i)return i.getBoundingClientRect().top;console.error("Can't find mobile list element")}},_newPointError:function(){this.set("addPointDisabled",!1)},_ironListResizeScrollThreshold:function(e){return 300},_ironListPaddingTop:function(e){return e?600:500},ready:function(){navigator.userAgent.toLowerCase().indexOf("android")>-1&&this.set("isAndroid",!0)},listeners:{"yp-point-deleted":"_pointDeleted"},observers:["_setupPointTextStartState(pointUpOrDownSelected, post)"],_setupPointTextStartState:function(e,t){t&&this._pointUpOrDownSelectedChanged(e)},_loadNewPointsIfNeeded:function(e,t){this.post&&this.post.id==t.postId&&(this.latestPointCreatedAt?(this.$.newPointsAjax.url="/api/posts/"+this.post.id+"/newPoints",this.$.newPointsAjax.params={latestPointCreatedAt:this.latestPointCreatedAt},this.$.newPointsAjax.generateRequest()):console.error("Trying to send point without latestPointCreatedAt"))},_newPointsResponse:function(e,t){this._preProcessPoints(t.response).forEach(function(e){this._insertNewPoint(e)}.bind(this)),this._updateCounterInfo()},_pointDeleted:function(){this.$.ajax.generateRequest()},_pointsChanged:function(e){e&&this._updateEmojiBindings()},_updateEmojiBindings:function(){this.async(function(){if(this.largeMode){var e=this.$$("#up_point"),t=this.$$("#down_point"),i=this.$$("#pointUpEmojiSelector"),o=this.$$("#pointDownEmojiSelector");e&&t&&i&&o?(i.inputTarget=e,o.inputTarget=t):console.warn("Wide: Can't bind emojis :(")}else{var n=this.$$("#mobileUpOrDownPoint"),s=this.$$("#pointUpDownEmojiSelector");n&&s?s.inputTarget=n:console.warn("Small: Can't bind emojis :(")}}.bind(this),500)},_pointUpOrDownSelectedChanged:function(e){"pointFor"==e?(this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointForLabel?this.set("labelMobileUpOrDown",this.post.Group.configuration.alternativePointForLabel):this.set("labelMobileUpOrDown",this.t("point.for")),this.set("selectedPointForMobile",!0)):"pointAgainst"==e&&(this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointAgainstLabel?this.set("labelMobileUpOrDown",this.post.Group.configuration.alternativePointAgainstLabel):this.set("labelMobileUpOrDown",this.t("point.against")),this.set("selectedPointForMobile",!1))},_clearVideo:function(){this.set("uploadedVideoUpId",null),this.set("uploadedVideoDownId",null),this.set("uploadedVideoMobileId",null),this.set("currentVideoId",null),this.set("hideUpVideo",!1),this.set("hideDownVideo",!1),this.set("hideMobileVideo",!1),this.$$("#videoFileUploadUp")&&this.$$("#videoFileUploadUp").clear(),this.$$("#videoFileUploadDown")&&this.$$("#videoFileUploadDown").clear(),this.$$("#videoFileUploadMobile")&&this.$$("#videoFileUploadMobile").clear()},_clearAudio:function(){this.set("uploadedAudioUpId",null),this.set("uploadedAudioDownId",null),this.set("uploadedAudioMobileId",null),this.set("currentAudioId",null),this.set("hideUpAudio",!1),this.set("hideDownAudio",!1),this.set("hideMobileAudio",!1),this.$$("#audioFileUploadUp")&&this.$$("#audioFileUploadUp").clear(),this.$$("#audioFileUploadDown")&&this.$$("#audioFileUploadDown").clear(),this.$$("#audioFileUploadMobile")&&this.$$("#audioFileUploadMobile").clear()},_postChanged:function(e){this.set("points",null),this.set("upPoints",null),this.set("downPoints",null),this.set("latestPointCreatedAt",null),this._clearVideo(),this._clearAudio(),e&&(this.host?this.$.ajax.url=this.host+"/api/posts/"+e.id+"/points":this.$.ajax.url="/api/posts/"+e.id+"/points",this.$.ajax.generateRequest(),this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointForLabel?this.set("labelUp",this.post.Group.configuration.alternativePointForLabel):this.set("labelUp",this.t("point.for")),this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointAgainstLabel?this.set("labelDown",this.post.Group.configuration.alternativePointAgainstLabel):this.set("labelDown",this.t("point.against")))},removeElementsByClass:function(e,t){for(var i=e.getElementsByClassName(t);i.length>0;)i[0].parentNode.removeChild(i[0])},_response:function(e,t){var i=this._preProcessPoints(t.response);if(this.removeElementsByClass(this,"inserted-outside-list"),i.length>0){for(var o=[],n=[],s=0;s<i.length;s++)i[s].value>0?o.push(i[s]):i[s].value<0&&n.push(i[s]);this.set("upPoints",o),this.set("downPoints",n)}else this.set("upPoints",[]),this.set("downPoints",[]),this.set("points",[]);this.largeMode||this.set("points",this.interleaveArrays(this.upPoints,this.downPoints)),this._updateCounterInfo(),this._scrollPointIntoView()},_scrollToIdChanged:function(e){e&&this._scrollPointIntoView()},interleaveArrays:function(e,t){for(var i=[e,t],o=Math.max.apply(Math,i.map(function(e){return e.length})),n=[],s=0;s<o;++s)i.forEach(function(e){e.length>s&&n.push(e[s])});return n},_scrollPointIntoView:function(){this.points&&this.points.length>0&&this.scrollToId&&this.async(function(){var e=this.$$("#point"+this.scrollToId);console.log("Looking for point"),e&&(console.log("Scrolling to point"),e.scrollIntoView(),this.set("scrollToId",null),e.elevation=5,this.async(function(){e.elevation=1}.bind(this),1e4))}.bind(this),200)},_preProcessPoints:function(e){for(var t=0;t<e.length;t++)(!this.latestPointCreatedAt||!this.latestPointCreatedAt||e[t].created_at>this.latestPointCreatedAt)&&this.set("latestPointCreatedAt",e[t].created_at),e[t].latestContent=e[t].PointRevisions[e[t].PointRevisions.length-1].content;return e},_updateCounterInfo:function(){this.largeMode?this.fire("yp-debate-info",{count:this.upPoints.length+this.downPoints.length,firstPoint:this.upPoints[0]}):this.fire("yp-debate-info",{count:this.points.length,firstPoint:this.points[0]})},_insertNewPoint:function(e){this.largeMode?e.value>0?(this.unshift("upPoints",e),this.async(function(){this.$$("#ironListUp").fire("iron-resize")},700)):e.value<0&&(this.unshift("downPoints",e),this.async(function(){this.$$("#ironListDown").fire("iron-resize")},700)):(this.unshift("points",e),this.async(function(){this.$$("#ironListMobile").fire("iron-resize")},700))},_newPointResponse:function(e,t){if(this.currentVideoId){var i=this._preProcessPoints([t.response])[0];(o=document.createElement("iron-ajax")).handleAs="json",o.contentType="application/json",o.url="/api/videos/"+i.id+"/completeAndAddToPoint",o.method="PUT",o.body={videoId:this.currentVideoId,appLanguage:this.language},o.addEventListener("response",function(e,t){this._completeNewPointResponse(e,e.detail),window.appGlobals.showSpeechToTextInfoIfNeeded()}.bind(this)),o.generateRequest()}else if(this.currentAudioId){var o;i=this._preProcessPoints([t.response])[0],(o=document.createElement("iron-ajax")).handleAs="json",o.contentType="application/json",o.url="/api/audios/"+i.id+"/completeAndAddToPoint",o.method="PUT",o.body={audioId:this.currentAudioId,appLanguage:this.language},o.addEventListener("response",function(e,t){this._completeNewPointResponse(e,e.detail),window.appGlobals.showSpeechToTextInfoIfNeeded()}.bind(this)),o.generateRequest()}else this._completeNewPointResponse(e,t)},_completeNewPointResponse:function(e,t){this.set("addPointDisabled",!1);var i=this._preProcessPoints([t.response])[0];this.currentVideoId?i.checkTranscriptFor="video":this.currentAudioId&&(i.checkTranscriptFor="audio"),i.value>0?(this.newPointTextCombined=this.t("point.forAdded")+" "+this.truncate(i.content,21),this.set("textValueUp","")):(this.newPointTextCombined=this.t("point.againstAdded")+" "+this.truncate(i.content,21),this.set("textValueDown","")),this.set("textValueMobileUpOrDown",""),this._insertNewPoint(i),this.set("post.counter_points",this.post.counter_points+1),this.$.newPointToast.show(),this._updateCounterInfo(),i.value>0?window.appGlobals.activity("completed","newPointFor"):window.appGlobals.activity("completed","newPointAgainst"),this._clearVideo(),this._clearAudio()},addPointUp:function(){this.addPoint(this.textValueUp,1,this.uploadedVideoUpId,this.uploadedAudioUpId),window.appGlobals.activity("add","pointUp")},addPointDown:function(){this.addPoint(this.textValueDown,-1,this.uploadedVideoDownId,this.uploadedAudioDownId),window.appGlobals.activity("add","pointDown")},addMobilePointUpOrDown:function(){"pointFor"==this.pointUpOrDownSelected?(this.addPoint(this.textValueMobileUpOrDown,1,this.uploadedVideoMobileId,this.uploadedAudioMobileId),window.appGlobals.activity("add","pointUp")):"pointAgainst"==this.pointUpOrDownSelected&&(this.addPoint(this.textValueMobileUpOrDown,-1,this.uploadedVideoMobileId,this.uploadedAudioMobileId),window.appGlobals.activity("add","pointDown"))},addPoint:function(e,t,i,o){!0===window.appUser.loggedIn()?(this.$.newPointAjax.url="/api/points/"+this.post.group_id,this.$.newPointAjax.body={postId:this.post.id,content:e,value:t},this.$.newPointAjax.generateRequest(),this.set("addPointDisabled",!0),i?this.set("currentVideoId",i):o&&this.set("currentAudioId",o)):window.appUser.loginForNewPoint(this,{content:e,value:t})},focusUpPoint:function(){window.appGlobals.activity("focus","pointUp")},focusDownPoint:function(){window.appGlobals.activity("focus","pointDown")},focusTextArea:function(e){e.currentTarget.parentElement.elevation=3},blurTextArea:function(e){e.currentTarget.parentElement.elevation=1},_hasCurrentUpVideo:function(e){e?(this.set("hideUpAudio",!0),this.set("hideUpText",!0)):(this.set("hideUpAudio",!1),this.set("hideUpText",!1))},_hasCurrentDownVideo:function(e){e?(this.set("hideDownAudio",!0),this.set("hideDownText",!0)):(this.set("hideDownAudio",!1),this.set("hideDownText",!1))},_hasCurrentUpAudio:function(e){e?(this.set("hideUpVideo",!0),this.set("hideUpText",!0)):(this.set("hideUpVideo",!1),this.set("hideUpText",!1))},_hasCurrentDownAudio:function(e){e?(this.set("hideDownVideo",!0),this.set("hideDownText",!0)):(this.set("hideDownVideo",!1),this.set("hideDownText",!1))},_hasCurrentMobileVideo:function(e){e?(this.set("hideMobileAudio",!0),this.set("hideMobileText",!0)):(this.set("hideMobileAudio",!1),this.set("hideMobileText",!1))},_hasCurrentMobileAudio:function(e){e?(this.set("hideMobileVideo",!0),this.set("hideMobileText",!0)):(this.set("hideMobileVideo",!1),this.set("hideMobileText",!1))},ifLengthIsRight:function(e,t,i,o){return null!=i?("up"===e&&(this.set("hideUpVideo",!1),this.set("hideUpAudio",!0),this.set("hideUpText",!0)),"down"===e&&(this.set("hideDownVideo",!1),this.set("hideDownAudio",!0),this.set("hideDownText",!0)),"mobile"===e&&(this.set("hideMobileVideo",!1),this.set("hideMobileAudio",!0),this.set("hideMobileText",!0)),!0):null!=o?("up"===e&&(this.set("hideUpAudio",!1),this.set("hideUpVideo",!0),this.set("hideUpText",!0)),"down"===e&&(this.set("hideDownAudio",!1),this.set("hideDownVideo",!0),this.set("hideDownText",!0)),"mobile"===e&&(this.set("hideMobileAudio",!1),this.set("hideMobileVideo",!0),this.set("hideMobileText",!0)),!0):null!=t&&0===t.length?("up"===e&&(this.set("hideUpVideo",!1),this.set("hideUpAudio",!1),this.set("hideUpText",!1)),"down"===e&&(this.set("hideDownVideo",!1),this.set("hideDownAudio",!1),this.set("hideDownText",!1)),"mobile"===e&&(this.set("hideMobileVideo",!1),this.set("hideMobileAudio",!1),this.set("hideMobileText",!1)),!1):null!=t&&t.length>0?("up"===e&&(this.set("hideUpVideo",!0),this.set("hideUpAudio",!0),this.set("hideUpText",!1)),"down"===e&&(this.set("hideDownVideo",!0),this.set("hideDownAudio",!0),this.set("hideDownText",!1)),"mobile"===e&&(this.set("hideMobileVideo",!0),this.set("hideMobileAudio",!0),this.set("hideMobileText",!1)),!0):null!=t&&t.length>1}});</script></dom-module><dom-module id="yp-post-user-image-card"><template><style include="iron-flex iron-flex-alignment">.description{padding-left:16px;padding-right:16px;padding-top:16px;color:#444}.photographer{padding-left:16px;padding-right:16px;padding-top:8px;color:#aaa}paper-material{width:800px;height:100%;background-color:#FFF;padding:0}iron-image{width:800px;height:600px}@media (max-width:800px){iron-image{width:600px;height:450px}paper-material{width:600px}}@media (max-width:620px){iron-image{width:400px;height:300px}paper-material{width:400px}}@media (max-width:420px){iron-image{width:320px;height:240px}paper-material{width:320px}.commentsList{margin-left:16px}}.commentsList{margin-left:32px}[hidden]{display:none!important}</style><paper-material elevation="2" class="layout vertical"><iron-image title$="[[image.description]]" sizing="cover" src$="[[_imageUrl(image)]]"></iron-image><div class="description">[[image.description]]</div><div class="layout horizontal" style="width:100%"><div class="photographer">[[image.photographer_name]]</div><div class="editMenu layout horizontal flex end-justified" hidden$="[[!hasImageAccess(image, post)]]"><paper-icon-button icon="create" on-tap="_openEdit"></paper-icon-button><paper-icon-button icon="clear" on-tap="_openDelete"></paper-icon-button></div></div><yp-point-comment-list class="commentsList" image="[[image]]"></yp-point-comment-list></paper-material></template><script>Polymer({is:"yp-post-user-image-card",behaviors:[Polymer.ypLanguageBehavior,Polymer.AccessHelpers,Polymer.ypMediaFormatsBehavior],properties:{image:{type:Object},post:{type:Object}},_openEdit:function(){window.appGlobals.activity("open","userImage.edit"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("userImageEdit",function(e){e.setup(this.post,this.image,!1,this._refresh.bind(this)),e.open("edit",{postId:this.post.id,userImages:!0})}.bind(this))},_openDelete:function(){window.appGlobals.activity("open","userImage.delete"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/images/"+this.post.id+"/"+this.image.id+"/user_images",this.t("userImage.deleteConfirmation"),this._refresh.bind(this)),e.open()}.bind(this))},_refresh:function(){this.fire("refresh")},_imageUrl:function(e){return this.getImageFormatUrl([e],0)}});</script></dom-module><dom-module id="yp-post-user-images"><template><style include="iron-flex iron-flex-alignment">paper-button{margin-top:32px;margin-bottom:8px;background-color:var(--accent-color);color:#FFF;width:242px}yp-post-user-image-card{margin-top:32px;margin-bottom:32px}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><div class="layout vertical center-center"><template is="dom-if" if="[[post]]"><paper-button raised="" on-tap="_newImage">[[t('posts.newUserImage')]]</paper-button><template is="dom-if" if="[[images]]"><template is="dom-repeat" items="[[images]]" as="image"><yp-post-user-image-card post="[[post]]" image="[[image]]" on-refresh="_refresh"></yp-post-user-image-card></template></template></template><div class="layout horizontal center-center"><yp-ajax id="ajax" on-response="_response"></yp-ajax></div></div></template><script>Polymer({is:"yp-post-user-images",behaviors:[Polymer.ypLanguageBehavior],properties:{images:{type:Array,value:null},post:{type:Object,observer:"_postChanged"}},_refresh:function(){this.$.ajax.generateRequest()},_postChanged:function(e){e&&(this.$.ajax.url="/api/images/"+e.id+"/user_images",this.$.ajax.generateRequest())},_newImage:function(){window.appGlobals.activity("open","newUserImage"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("userImageEdit",function(e){e.setup(this.post,null,!0,this._refresh.bind(this)),e.open("new",{postId:this.post.id,userImages:!0})}.bind(this))},_response:function(e,s){this.set("images",s.response),this.images&&this.images.length>0?this.fire("yp-post-image-count",this.images.length):this.fire("yp-post-image-count",0)}});</script></dom-module></div><dom-module id="yp-post"><template><style include="iron-flex iron-flex-alignment">.container{padding-top:0;margin-top:-70px;height:100%}.flex{@apply --layout-vertical;@apply --layout-flex;}.centerContainer{@apply --layout-center-center;}.postHeader{padding:16px;background-color:#fefefe;width:940px}.statusHeader{padding:16px;background-color:#fefefe;width:940px;margin-top:16px;height:48px}.description{width:510px;padding-left:24px}ac-activities{padding-top:8px}.statusColumn{width:670px;padding-bottom:16px}.mainPage{background-color:#FFF}yp-post-user-images{padding-top:32px}@media (max-width:961px){.postHeader{width:600px}}@media (max-width:600px){.postHeader{width:400px}}.createFab{position:fixed;bottom:24px;right:28px;background-color:var(--accent-color);color:#FFF;--paper-fab-iron-icon:{color:var(--icon-general-color,#FFF);height:40px;width:40px};}.createFab[wide-layout]{width:72px;height:72px;--paper-fab-iron-icon:{color:var(--icon-general-color,#FFF);width:72px;height:72px};}@media (max-width:360px){.centerContainer{@apply --layout-vertical;}.postHeader{height:100%;width:360px;padding:0}.tabsMaterial{width:360px}.statusHeader{width:360px;height:120px;padding:0;padding-left:20px}.statusColumn{height:60px;padding:0}.description{width:320px;padding:8px;padding-left:20px;padding-bottom:16px}.statusColumn{width:320px}}yp-ajax{background-color:var(--primary-background-color)}.mapContainer{margin:24px;width:960px;height:500px}.counterInfo{font-size:11px}.topContainer{margin-top:16px}.tabs{margin-top:24px}@media (max-width:934px){.mapContainer{margin:16px;width:800px;height:400px}}@media (max-width:832px){.mapContainer{margin:8px;width:600px;height:340px}}@media (max-width:632px){.mapContainer{margin:8px;width:400px;height:300px}}@media (max-width:420px){.mapContainer{margin:8px;width:330px;height:250px}}@media (max-width:360px){.mapContainer{margin:8px;width:280px;height:200px}}.tabs{width:1100px;padding-top:8px;padding-bottom:8px}.tabs .tab{width:250px}@media (max-width:1024px){.tabs{max-width:920px}.tabs .tab{width:200px}}@media (max-width:900px){.tabs{max-width:100%;font-size:13px!important;word-wrap:break-word!important;margin-top:16px;width:100%;margin-bottom:16px}.tabs .tab{width:100%;word-wrap:break-word!important;margin-left:8px;margin-right:8px}.topArea{height:300px}.topArea[is-post]{min-height:470px}}@media (max-width:360px){.tabs{font-size:10px!important}.topArea[is-post]{min-height:530px}ac-activities{min-height:600px!important}}.minHeightSection{min-height:450px}[hidden]{display:none!important}</style><div class="topContainer layout vertical center-center" is-post="" create-fab-title="[[t('point.add')]]" on-yp-create-fab-tap="_newPoint"><yp-post-header id="postCard" class="largeCard" post="[[post]]" on-refresh="_refreshAjax" header-mode=""></yp-post-header><div class="layout horizontal center-center" hidden$="[[post.Group.configuration.hideAllTabs]]"><paper-tabs id="paper_tabs" class="tabs" selected="{{selectedTab}}" attr-for-selected="name" focused=""><paper-tab name="debate"><div class="layout vertical center-center tabCounterContainer"><span>[[t('post.tabs.debate')]] (<span id="tabCountDebate"></span>)</span></div></paper-tab><paper-tab name="news">[[t('post.tabs.news')]]</paper-tab><paper-tab name="location" hidden$="[[locationHidden]]">[[t('post.tabs.location')]]</paper-tab><paper-tab name="photos"><div class="layout vertical center-center tabCounterContainer"><span>[[t('post.tabs.photos')]] (<span id="tabCountPhotos"></span>)</span></div></paper-tab></paper-tabs></div><iron-pages id="pages" class="tabPages" selected="[[selectedTab]]" attr-for-selected="name" entry-animation="fade-in-animation" exit-animation="fade-out-animation"><div name="debate" class="layout horizontal center-center"><yp-post-points host="[[host]]" id="pointsSection" post="[[post]]" scroll-to-id$="[[scrollToPointId]]"></yp-post-points></div><section name="news" class="minHeightSection"><template is="dom-if" if="[[newsTabSelected]]"><ac-activities id="postNews" selected-tab="[[selectedTab]]" disable-new-posts="[[disableNewPosts]]" post-group-id="[[post.group_id]]" post-id="[[post.id]]"></ac-activities></template></section><section name="location" class="minHeightSection"><div class="layout horizontal center-center"><template is="dom-if" if="[[post.location]]" restamp=""><template is="dom-if" if="[[mapActive]]" restamp=""><paper-material class="mapContainer" elevation="3"><google-map additional-map-options="{&quot;keyboardShortcuts&quot;:false}" api-key="AIzaSyDkF_kak8BVZA5zfp5R4xRnrX8HP3hjiL0" id="map" libraries="places" class="map" map-type="[[post.location.mapType]]" zoom="[[post.location.map_zoom]]" fit-to-markers=""><google-map-marker slot="markers" latitude="[[post.location.latitude]]" longitude="[[post.location.longitude]]" id="marker"></google-map-marker></google-map></paper-material></template></template><template is="dom-if" if="[[post]]"><template is="dom-if" if="[[!post.location]]"><h1 style="padding-top:16px">[[t('post.noLocation')]]</h1></template></template></div></section><section name="photos" class="minHeightSection"><div class="layout vertical flex"><div class="layout horizontal center-center"><yp-post-user-images post="[[post]]"></yp-post-user-images></div></div></section></iron-pages></div><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><app-route route="{{idRoute}}" pattern="/:id" data="{{idRouteData}}" tail="{{tabRoute}}"></app-route><app-route route="{{tabRoute}}" pattern="/:tabName" data="{{tabRouteData}}"></app-route><iron-media-query query="(min-width: 1024px)" query-matches="{{wideWidth}}"></iron-media-query><div class="create-fab-wrapper layout horizontal end-justified createFabContainer" hidden$="[[post.Group.configuration.hideNewPostOnPostPage]]"><template is="dom-if" if="[[!disableNewPosts]]"><paper-fab class="createFab" icon="[[createFabIcon]]" elevation="5" wide-layout$="{{wideWidth}}" title="[[createFabTitle]]" on-tap="_newPost"></paper-fab></template></div><div class="layout horizontal center-center"><yp-ajax id="ajax" on-response="_response"></yp-ajax><yp-ajax id="pagesAjax" on-response="_pagesResponse"></yp-ajax></div></template><script>Polymer({is:"yp-post",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypThemeBehavior,Polymer.YpNewsTabSelected,Polymer.ypGotoBehavior,Polymer.ypMediaFormatsBehavior,Polymer.ypNumberFormatBehavior,Polymer.ypTruncateBehavior],properties:{idRoute:Object,tabRoute:Object,idRouteData:Object,tabRouteData:Object,postId:{type:Number,value:null,observer:"_postIdChanged"},host:String,post:{type:Object,value:null,notify:!0,observer:"_postChanged"},selectedTab:{type:String,value:"debate",observer:"_selectedTabChanged"},small:{type:Boolean},method:{type:String},mapActive:{type:Boolean,value:!1},wideWidth:{type:Boolean,value:!1},createFabIcon:{type:String,value:"lightbulb-outline"},disableNewPosts:{type:Boolean,value:!1},scrollToPointId:{type:String,value:null},locationHidden:{type:Boolean,value:!1}},observers:["_routeIdChanged(idRouteData.id)","_routeTabChanged(tabRouteData.tabName)"],_routeIdChanged:function(t){t&&this.set("postId",t)},_routeTabChanged:function(t){t&&!this._isNumber(t)?this.set("selectedTab",t):t&&this._isNumber(t)&&(this.set("scrollToPointId",t),this.set("selectedTab","debate"))},_isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},_selectedTabChanged:function(t){this.post&&this.redirectTo("/post/"+this.post.id+"/"+t),"location"==t?this.set("mapActive",!0):this.set("mapActive",!1),t&&window.appGlobals&&window.appGlobals.activity("open","post_tab_"+t),this.async(function(){var t=this.$$("#postNews");t&&t.fireResize()},300)},_newPost:function(){window.appGlobals.activity("open","newPost"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("postEdit",function(t){t.setup(null,!0,null),t.open("new",{groupId:this.post.Group.id,group:this.post.Group})}.bind(this))},listeners:{"yp-debate-info":"_updateDebateInfo","yp-post-image-count":"_updatePostImageCount"},_updatePostImageCount:function(t,o){var e=this.$$("#tabCountPhotos");e&&(e.innerHTML=this.formatNumber(o))},_updateDebateInfo:function(t,o){var e=this.$$("#tabCountDebate");e&&(e.innerHTML=this.formatNumber(o.count)),o.firstPoint&&this.$.postCard.updateDescriptionIfEmpty(o.firstPoint.content)},_mainContainerClasses:function(t){return t?"layout horizontal wrap":"layout horizontal center-center"},_headerClasses:function(t){return t?"layout vertical postHeader wrap":"layout horizontal postHeader"},postName:function(t){return t&&t.name?this.truncate(this.trim(t.name),200):t?t.short_name:void 0},postDescription:function(t){return t&&t.description?this.truncate(this.trim(t.description),1e4,"..."):""},_refreshAjax:function(){this.$.ajax.generateRequest()},_postChanged:function(t,o){},_postIdChanged:function(t,o){this.set("post",null),t&&(this._getPost(),this.set("selectedTab","debate"))},_pagesResponse:function(t,o){this.fire("yp-set-pages",o.response)},_getPost:function(){this.host?this.$.ajax.url=this.host+"/api/posts/"+this.postId:this.$.ajax.url="/api/posts/"+this.postId,this.$$("#ajax").retryMethodAfter401Login=this._getPost.bind(this),this.$.ajax.generateRequest()},_response:function(t,o,e){this.set("post",o.response),this.refresh(),this.post.Group.configuration&&void 0!=this.post.Group.configuration.canAddNewPosts?!0===this.post.Group.configuration.canAddNewPosts?this.set("disableNewPosts",!1):this.set("disableNewPosts",!0):this.set("disableNewPosts",!1),null===this.post.description&&(this.post.description=this.post.Points[0].content,this.post.Points.shift())},refresh:function(){this.post&&(null!=this.post.Group.theme_id?this.setTheme(this.post.Group.theme_id):this.post.Group.Community&&null!=this.post.Group.Community.theme_id&&this.setTheme(this.post.Group.Community.theme_id),window.appGlobals&&(window.appGlobals.setCommunityAnalyticsTracker(this.post.Group.Community.google_analytics_code),this.post.Group.Community.configuration&&window.appGlobals.setCommunityPixelTracker(this.post.Group.Community.configuration.facebookPixelId),window.appGlobals.setAnonymousGroupStatus(this.post.Group)),this.post.Group.configuration&&null!=this.post.Group.configuration.defaultLocale&&window.appGlobals.changeLocaleIfNeeded(this.post.Group.configuration.defaultLocale),this.post.Group.configuration&&void 0!=this.post.Group.configuration.locationHidden?this.set("locationHidden",this.post.Group.configuration.locationHidden):this.set("locationHidden",!1),this.fire("change-header",{headerTitle:this.truncate(this.post.Group.name,80),documentTitle:this.post.name,headerDescription:"",backPath:"/group/"+this.post.group_id,hideHelpIcon:!(!this.post.Group.configuration||!this.post.Group.configuration.hideHelpIcon)||null}),this.$.pagesAjax.url="/api/groups/"+this.post.Group.id+"/pages",this.$.pagesAjax.generateRequest(),this.post.Group.configuration&&!0===this.post.Group.configuration.disableFacebookLoginForGroup?window.appGlobals.disableFacebookLoginForGroup=!0:window.appGlobals.disableFacebookLoginForGroup=!1,this.fire("yp-set-home-link",{type:"group",id:this.post.Group.id,name:this.post.Group.name}),this.post.Group&&this.post.Group.Community&&this.post.Group.Community.configuration&&this.post.Group.Community.configuration.signupTermsPageId&&-1!=this.post.Group.Community.configuration.signupTermsPageId?window.appGlobals.signupTermsPageId=this.post.Group.Community.configuration.signupTermsPageId:window.appGlobals.signupTermsPageId=null,this.post.Group.configuration&&this.post.Group.configuration.forceSecureSamlLogin?window.appGlobals.currentGroupForceSaml=!0:window.appGlobals.currentGroupForceSaml=!1)},setupTopHeaderImage:function(t){var o="url("+this.getImageFormatUrl(t,0)+")";this.updateStyles({"--top-area-background-image":o})},computeUrl:function(t){return"/api/posts/"+t}});</script></dom-module>