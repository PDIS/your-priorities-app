<div hidden="" by-polymer-bundler=""><dom-module id="yp-group-card" assetpath="../yp-group/"><template><style include="iron-flex iron-flex-alignment">:host{display:block;@apply --layout-vertical;width:416px}.description{color:var(--primary-color-more-darker,#424242);line-height:var(--description-line-height,1.3)}.groupCard{height:445px;background-color:#fff}.objectives{@apply --layout-vertical;color:var(--primary-color-more-darker,#424242);line-height:var(--objectives-line-height,1.3);padding:16px}.stats{position:absolute;bottom:0;right:8px}.group-name[archived]{background-color:#aaa}iron-image[archived]{opacity:.85;filter:alpha(opacity=85)}iron-image{width:416px;height:234px;display:block}yp-group-stats{color:var(--primary-color-more-darker,#424242)}paper-card{background-color:red;vertical-align:text-top}.informationText{vertical-align:text-top}.group-name{margin:0;font-size:var(--large-heading-size,26px);height:45px;padding:14px;background-color:var(--primary-color-800);color:#FFF;font-weight:700;cursor:pointer;vertical-align:middle;display:table-cell!important;width:416px}.group-name[featured]{font-size:25px;background-color:var(--accent-color)}yp-membership-button[archived]{display:none}yp-membership-button{position:absolute;right:16px;top:214px;width:32px;height:32px;color:var(--icon-general-color,#FFF)}.objectives{padding:8px}@media (max-width:420px){:host{width:304px}.groupCard{margin-left:0;margin-right:8px;padding-left:0;padding-right:0;width:304px}iron-image{width:304px;height:165px}.group-name{width:304px}}.withPointer{cursor:pointer}[hidden]{display:none!important}</style><iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query><template is="dom-if" if="[[group]]"><paper-card class="groupCard" animated="" elevation="[[elevation]]"><template is="dom-if" if="[[noImage]]"><iron-image header-mode$="[[headerMode]]" archived$="[[archived]]" sizing="cover" class="main-image withPointer" src="https://i.imgur.com/sdsFAoT.png" on-tap="_goToGroup"></iron-image></template><template is="dom-if" if="[[!noImage]]"><iron-image archived$="[[archived]]" class="logo withPointer" sizing="cover" on-tap="_goToGroup" preload="" src="[[groupLogoImagePath]]"></iron-image></template><div id="groupName" class="group-name" archived$="[[archived]]" featured$="[[featured]]" on-tap="_goToGroup"><yp-magic-text text-type="groupName" content-language="[[group.language]]" disable-translation="[[group.configuration.disableNameAutoTranslation]]" text-only="" content="[[groupName]]" content-id="[[group.id]]"></yp-magic-text><span hidden$="[[!archived]]">- [[t('archived')]]</span></div><yp-magic-text id="objectives" class="objectives withPointer" on-tap="_goToGroup" text-type="groupContent" content-language="[[group.language]]" text-only="" content="[[groupObjectives]]" content-id="[[group.id]]" truncate="200"></yp-magic-text><yp-group-stats class="stats" group="[[group]]"></yp-group-stats><yp-membership-button archived$="[[archived]]" group="[[group]]"></yp-membership-button></paper-card></template></template><script>Polymer({is:"yp-group-card",behaviors:[Polymer.ypLanguageBehavior,Polymer.GroupBehaviors,Polymer.ypTruncateBehavior,Polymer.ypMediaFormatsBehavior,Polymer.ypGotoBehavior]});</script></dom-module><dom-module id="yp-group-grid" assetpath="../yp-group/"><template><style include="iron-flex iron-flex-alignment">.groupCard{padding:0;padding-top:16px}.groupCard[wide-padding]{padding:16px!important}[hidden]{display:none!important}:focus{outline:0}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query><div class="layout vertical center-center"><iron-list id="ironList" scroll-offset="350" items="[[activeGroups]]" as="group" scroll-target="document" grid=""><template><div class="groupCard" tabindex$="[[tabIndex]]" wide-padding$="[[wide]]"><yp-group-card wide-padding$="[[wide]]" group="[[group]]" on-mouseover="cardMouseOver" on-mouseout="cardMouseOut"></yp-group-card></div></template></iron-list></div></template><script>Polymer({is:"yp-group-grid",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypIronListBehavior,Polymer.ypCardMouseBehavior],properties:{featuredGroups:Array,archivedGroups:Array,activeGroups:Array,hideAdd:{type:Boolean,value:!1},wide:{type:Boolean,value:!1}},_newGroup:function(){this.fire("add-new-group")}});</script></dom-module><dom-module id="yp-community-header"><template><style include="iron-flex iron-flex-alignment">.communityAccess{padding-bottom:8px}.description{line-height:var(--description-line-height,1.3);background-color:rgba(250,250,250,0);color:#111;font-size:18px;text-align:center;max-width:750px;padding-left:16px;padding-right:16px}.stats{background-color:rgba(250,250,250,0);--main-stats-color-on-white:#000}iron-image{width:432px;height:243px}.large-card{background-color:#fefefe;color:#333;height:243px;width:432px;padding:0!important;margin-top:0!important}.image{width:100px;height:100px;margin-top:8px}.edit{color:#FFF;padding-right:0;margin-right:0}.contentContainer{@apply --layout-horizontal;}.textBox{margin-right:32px}.community-name{background-color:rgba(250,250,250,0);color:#222;font-weight:700;font-size:58px;padding-top:8px;padding-left:16px;padding-right:16px}.nameBorder{border-bottom:2px solid;margin-bottom:8px;margin-top:8px;margin-left:180px;margin-right:180px}@media (max-width:945px){:host{width:306px}.large-card{width:306px;height:100%}.top-card{margin-bottom:16px}.community-name{font-size:28px;text-align:center;padding-top:4px;padding-bottom:4px}.description{font-size:17px}.communityDescription{padding-top:6px;padding-bottom:4px}.textBox{margin-right:0}}.rounded-even-more{-webkit-border-radius:90px;-moz-border-radius:90px;border-radius:90px;display:block;vertical-align:top;align:center;-webkit-transform-style:preserve-3d}[hidden]{display:none!important}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><template is="dom-if" if="[[community]]"><div class="layout vertical center-center"><iron-image class="image rounded-even-more" sizing="cover" src$="[[communityLogoImagePath]]"></iron-image><div class="community-name rounded-even-more">[[communityNameFull]]</div><div class="layout horizontal center-center"><yp-community-stats class="stats" community="[[community]]"></yp-community-stats></div><div class="description layout horizontal center-center rounded-even-more"><div id="description" class="communityDescription"></div><div><paper-menu-button class="edit" vertical-align="top" horizontal-align="[[editMenuAlign]]" hidden$="[[!hasCommunityAccess]]"><paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content" on-iron-select="_menuSelection" selected="{{selectedMenuItem}}"><paper-item id="editMenuItem">[[t('community.edit')]]</paper-item><paper-item id="usersMenuItem">[[t('community.users')]]</paper-item><paper-item id="adminsMenuItem">[[t('community.admins')]]</paper-item><paper-item id="deleteMenuItem">[[t('community.delete')]]</paper-item><paper-item id="pagesMenuItem">[[t('pages.managePages')]]</paper-item><paper-item id="bulkStatusUpdateMenuItem">[[t('bulkStatusUpdate')]]</paper-item></paper-listbox></paper-menu-button></div></div></div></template><iron-media-query query="(max-width: 800px)" query-matches="{{narrowScreen}}"></iron-media-query><lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal></template><script>Polymer({is:"yp-community-header",behaviors:[Polymer.ypLanguageBehavior,Polymer.CommunityBehaviors,Polymer.LargeCardBehaviors,Polymer.AccessHelpers,Polymer.ypGotAdminRightsBehavior,Polymer.ypGotoBehavior,Polymer.ypTruncateBehavior,Polymer.ypMediaFormatsBehavior],properties:{community:{type:Object,observer:"_communityChanged"},hasCommunityAccess:{type:Boolean,value:!1,computed:"_hasCommunityAccess(community, gotAdminRights)"}},_communityChanged:function(e){},_hasCommunityAccess:function(e,t){return!(!e||!t)&&null!=this.checkCommunityAccess(e)},_communityAccessText:function(e){switch(e){case 0:return this.t("community.public");case 1:return this.t("community.closed");case 2:return this.t("community.secret")}},_menuSelection:function(e,t){"editMenuItem"==t.item.id?this._openEdit():"deleteMenuItem"==t.item.id?this._openDelete():"usersMenuItem"==t.item.id?this._openUsersDialog():"adminsMenuItem"==t.item.id?this._openAdminsDialog():"pagesMenuItem"==t.item.id?this._openPagesDialog():(t.item.id="bulkStatusUpdateMenuItem")&&this._openBulkStatusUpdates(),this.set("selectedMenuItem",null)},_openBulkStatusUpdates:function(){window.appGlobals.activity("open","community.bulkStatusUpdates"),document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"open-bulk-status-updates",data:null}})),Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateGrid",function(e){e.open(this.community.id)}.bind(this))},_openUsersDialog:function(){window.appGlobals.activity("open","community.users"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(null,this.community.id,null,!1),e.open(this.community.name)}.bind(this))},_openAdminsDialog:function(){window.appGlobals.activity("open","community.admins"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(null,this.community.id,null,!0),e.open(this.community.name),e.open()}.bind(this))},_openPagesDialog:function(){window.appGlobals.activity("open","community.pagesAdmin"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("pagesGrid",function(e){e.setup(null,this.community.id,null,!1),e.open()}.bind(this))},_openDelete:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/communities/"+this.community.id,this.t("community.deleteConfirmation"),this._onDeleted.bind(this)),e.open()}.bind(this))},_openEdit:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("communityEdit",function(e){e.setup(this.community,!1,this._refresh.bind(this)),e.open("edit",{communityId:this.community.id})}.bind(this))},_onDeleted:function(){this.redirectTo("/domain/"+this.community.domain_id)},_refresh:function(e){e&&this.set("community",e),this.fire("update-community")}});</script></dom-module><dom-module id="yp-community-large-card"><template><style include="iron-flex iron-flex-alignment">.communityAccess{padding-bottom:8px}.description{line-height:var(--description-line-height,1.3)}.stats{position:absolute;bottom:0;right:8px}.community-name{padding:0;padding-bottom:4px;padding-right:1px;margin:0;font-size:24px;font-weight:700}iron-image,video{width:432px;height:243px}.large-card{background-color:#fefefe;color:#333;height:243px;width:432px;padding:0!important;margin-top:0!important}.image{width:432px;height:243px}.description-and-stats{width:100%}.edit{color:#FFF;position:absolute;top:0;left:390px;padding-right:0;margin-right:0}.contentContainer{@apply --layout-horizontal;}.description-and-stats{padding-bottom:32px}.description{padding:0;margin:0}.communityDescription{padding-left:16px;padding-right:16px;padding-top:16px}.community-name{background-color:var(--primary-color-800,#000);color:#fafafa;padding-left:16px;padding-top:16px;padding-bottom:16px;min-height:31px}.textBox{margin-left:32px;position:relative}#welcomeHTML{width:432px;max-width:432px;overflow:hidden}.k2017Image{height:72px}.k2017FeaturedImage{height:85px}.k2017extraMargin{margin-right:68px;margin-left:45px}.k2017topPadding{padding:8px}.k2017topPadding a:link{color:#333}.k2017topPadding a:visited{color:#333}.k2017showOnlyMobile{display:none}@media (max-width:945px){:host{width:306px}.k2017Image{height:42px}.k2017FeaturedImage{height:55px}.k2017extraMargin{margin-right:52px;margin-left:32px}.k2017topPadding{padding-top:4px}.k2017hiddenMobile{display:none}.k2017showOnlyMobile{display:inline}#welcomeHTML{width:306px;max-width:306px}.large-card{width:306px;height:100%}.top-card{margin-bottom:16px}.edit{left:265px}iron-image,video{width:306px;height:172px!important}.image{width:306px;height:172px!important}.imageCard{height:172px!important}.community-name{font-size:20px;min-height:26px}.communityDescription{padding-top:6px;padding-bottom:4px}.textBox{margin-left:0}}[hidden]{display:none!important}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><div class="layout horizontal wrap"><paper-material id="cardImage" elevation="3" animated="" class="large-card imageCard top-card"><div id="welcomeHTML" hidden$="[[!community.configuration.welcomeHTML]]" class="layout vertical center-center"></div><div hidden$="[[community.configuration.welcomeHTML]]"><template is="dom-if" if="[[communityVideoURL]]" restamp=""><video id="videoPlayer" data-id$="[[communityVideoId]]" controls="" preload="meta" class="image pointer" src="[[communityVideoURL]]" playsinline="" poster="[[communityVideoPosterURL]]"></video></template><template is="dom-if" if="[[!communityVideoURL]]"><iron-image class="image" sizing="cover" src$="[[communityLogoImagePath]]"></iron-image></template></div></paper-material><paper-material id="card" elevation="3" animated="" class="large-card textBox"><div class="layout vertical"><div class="layout horizontal wrap"><div class="layout vertical description-and-stats"><div class="description"><div class="community-name"><yp-magic-text text-type="communityName" content-language="[[community.language]]" disable-translation="[[community.configuration.disableNameAutoTranslation]]" text-only="" content="[[communityNameFull]]" content-id="[[community.id]]"></yp-magic-text></div><div hidden="" class="communityAccess">[[_communityAccessText(community.access)]]</div><yp-magic-text id="description" class="communityDescription" text-type="communityContent" content-language="[[community.language]]" content="[[community.description]]" content-id="[[community.id]]"></yp-magic-text></div></div></div><paper-menu-button class="edit" vertical-align="top" horizontal-align="[[editMenuAlign]]" hidden$="[[!showMenuItem]]"><paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content" on-iron-select="_menuSelection"><paper-item hidden$="[[!hasCommunityAccess]]" id="editMenuItem">[[t('community.edit')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="usersMenuItem">[[t('community.users')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="adminsMenuItem">[[t('community.admins')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="pagesMenuItem">[[t('pages.managePages')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="deleteMenuItem">[[t('community.delete')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="anonymizeMenuItem">[[t('anonymizeCommunityContent')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="deleteContentMenuItem">[[t('deleteCommunityContent')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="bulkStatusUpdateMenuItem">[[t('bulkStatusUpdate')]]</paper-item><paper-item id="addGroupMenuItem">[[t('group.new')]]</paper-item></paper-listbox></paper-menu-button></div><yp-community-stats class="stats" community="[[community]]"></yp-community-stats></paper-material></div><iron-media-query query="(max-width: 800px)" query-matches="{{narrowScreen}}"></iron-media-query><lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal><lite-signal on-lite-signal-yp-pause-media-playback="_pauseMediaPlayback"></lite-signal></template><script>Polymer({is:"yp-community-large-card",behaviors:[Polymer.ypLanguageBehavior,Polymer.CommunityBehaviors,Polymer.LargeCardBehaviors,Polymer.AccessHelpers,Polymer.ypGotAdminRightsBehavior,Polymer.ypGotoBehavior,Polymer.ypTruncateBehavior,Polymer.ypMediaFormatsBehavior],properties:{community:{type:Object,observer:"_communityChanged"},hasCommunityAccess:{type:Boolean,value:!1,computed:"_hasCommunityAccess(community, gotAdminRights)"},showMenuItem:{type:Boolean,value:!1,computed:"_showMenuItem(hasCommunityAccess, community)"},communityVideoURL:{type:String,computed:"_communityVideoURL(community)"},communityVideoPosterURL:{type:String,computed:"_communityVideoPosterURL(community)"},communityVideoId:Number},_communityVideoURL:function(e){if(e&&e.configuration.useVideoCover&&e.CommunityLogoVideos){var t=this._getVideoURL(e.CommunityLogoVideos);return t?(this.set("communityVideoId",e.CommunityLogoVideos[0].id),t):null}return null},_communityVideoPosterURL:function(e){if(e&&e.configuration.useVideoCover&&e.CommunityLogoVideos){var t=this._getVideoPosterURL(e.CommunityLogoVideos);return t||null}return null},_showMenuItem:function(e,t){return e||t&&!t.only_admins_can_create_groups},_communityChanged:function(e,t){e&&e.description&&(this.async(function(){if(e.configuration&&e.configuration.welcomeHTML&&""!==e.configuration.welcomeHTML&&this.$$("#welcomeHTML")){var t=document.createElement("div");t.innerHTML=e.configuration.welcomeHTML,this.$$("#welcomeHTML").innerHTML="",Polymer.dom(this.$$("#welcomeHTML")).appendChild(t)}else this.$$("#welcomeHTML")&&(this.$$("#welcomeHTML").innerHTML="")}),e.description.length>220&&e.name&&e.name.length>30?this.$$("#description").style.fontSize="15px":this.$$("#description").style.fontSize="16px"),this.setupMediaEventListeners(e,t)},_hasCommunityAccess:function(e,t){return!(!e||!t)&&null!=this.checkCommunityAccess(e)},_communityAccessText:function(e){switch(e){case 0:return this.t("community.public");case 1:return this.t("community.closed");case 2:return this.t("community.secret")}},_menuSelection:function(e,t){"editMenuItem"==t.item.id?this._openEdit():"deleteMenuItem"==t.item.id?this._openDelete():"usersMenuItem"==t.item.id?this._openUsersDialog():"adminsMenuItem"==t.item.id?this._openAdminsDialog():"pagesMenuItem"==t.item.id?this._openPagesDialog():"bulkStatusUpdateMenuItem"==t.item.id?this._openBulkStatusUpdates():"addGroupMenuItem"==t.item.id?this.fire("yp-new-group"):"anonymizeMenuItem"===t.item.id?this._openAnonymizeContent():"deleteContentMenuItem"===t.item.id&&this._openDeleteContent(),this.$$("paper-listbox").select(null)},_openBulkStatusUpdates:function(){window.appGlobals.activity("open","community.bulkStatusUpdates"),document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"open-bulk-status-updates",data:null}})),this.async(function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateGrid",function(e){e.open(this.community.id)}.bind(this))})},_openUsersDialog:function(){window.appGlobals.activity("open","community.users"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(null,this.community.id,null,!1),e.open(this.community.name)}.bind(this))},_openAdminsDialog:function(){window.appGlobals.activity("open","community.admins"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(null,this.community.id,null,!0),e.open(this.community.name)}.bind(this))},_openPagesDialog:function(){window.appGlobals.activity("open","community.pagesAdmin"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("pagesGrid",function(e){e.setup(null,this.community.id,null,!1),e.open()}.bind(this))},_openDelete:function(){window.appGlobals.activity("open","community.delete"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/communities/"+this.community.id,this.t("communityDeleteConfirmation"),this._onDeleted.bind(this)),e.open({finalDeleteWarning:!0})}.bind(this))},_openDeleteContent:function(){window.appGlobals.activity("open","community.deleteContents"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/communities/"+this.community.id+"/delete_content",this.t("communityDeleteContentConfirmation")),e.open({finalDeleteWarning:!0})}.bind(this))},_openAnonymizeContent:function(){window.appGlobals.activity("open","community.anonymize"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/communities/"+this.community.id+"/anonymize_content",this.t("communityAnonymizeConfirmation"),null,this.t("anonymize")),e.open({finalDeleteWarning:!0})}.bind(this))},_openEdit:function(){window.appGlobals.activity("open","community.edit"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("communityEdit",function(e){e.setup(this.community,!1,this._refresh.bind(this)),e.open("edit",{communityId:this.community.id})}.bind(this))},_onDeleted:function(){this.redirectTo("/domain/"+this.community.domain_id),this.dispatchEvent(new CustomEvent("yp-refresh-domain",{bubbles:!0,composed:!0}))},_refresh:function(e){e&&this.set("community",e),this.fire("update-community")}});</script></dom-module></div><dom-module id="yp-community"><template><style include="iron-flex iron-flex-alignment">.card-container{@apply --layout-horizontal;@apply --layout-wrap;}.card{padding:16px}yp-ajax{background-color:var(--primary-background-color)!important}.archivedText{font-size:26px;color:#333}.minHeightSection{min-height:450px}#paper_tabs[apple]{margin-top:42px;margin-bottom:8px}[hidden]{display:none!important}</style><yp-page id="page" create-fab-icon="[[createFabIcon]]" create-fab-title="[[t('group.add')]]" on-yp-create-fab-tap="_newGroup"><template is="dom-if" if="[[useAlternativeHeader]]"><yp-community-header hidden="" id="communityCard" slot="largeCard" class="largeCard card" community="[[community]]" on-update-community="_refreshAjax"></yp-community-header></template><template is="dom-if" if="[[useNormalHeader]]"><yp-community-large-card hidden="" id="communityCard" slot="largeCard" class="largeCard card" community="[[community]]" on-update-community="_refreshAjax"></yp-community-large-card></template><paper-tabs id="paper_tabs" apple$="[[isOldiOs]]" slot="tabs" class="tabs" selected="{{selectedTab}}" attr-for-selected="name" focused=""><paper-tab name="groups" class="tab"><span>[[t('groups')]]</span> &nbsp; (<span>[[groupsLength]]</span>)</paper-tab><paper-tab name="news" class="tab">[[t('news')]]</paper-tab><paper-tab name="map" class="tab" hidden$="[[locationHidden]]">[[t('posts.map')]]</paper-tab></paper-tabs><iron-pages class="tabPages" slot="tabPages" selected="{{selectedTab}}" attr-for-selected="name" entry-animation="fade-in-animation" exit-animation="fade-out-animation"><section name="groups"><div class="layout horizontal center-center wrap"><yp-group-grid featured-groups="[[featuredGroups]]" active-groups="[[activeGroups]]" archived-groups="[[archivedGroups]]" hide-add$="[[!createFabIcon]]" on-add-new-group="_newGroup"></yp-group-grid></div></section><section class="minHeightSection" name="news"><template is="dom-if" if="[[newsTabSelected]]"><ac-activities id="communityNews" selected-tab="[[selectedTab]]" community-id="[[community.id]]"></ac-activities></template></section><section class="minHeightSection" name="map" hidden$="[[locationHidden]]"><template is="dom-if" if="[[mapActive]]" restamp=""><yp-post-map community-id="[[community.id]]"></yp-post-map></template></section></iron-pages></yp-page><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-logged-in="_userLoggedIn"></lite-signal><lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal><app-route route="{{idRoute}}" pattern="/:id" data="{{idRouteData}}" tail="{{tabRoute}}"></app-route><app-route route="{{tabRoute}}" pattern="/:tabName" data="{{tabRouteData}}"></app-route><yp-ajax id="ajax" url="/api/communities" on-response="_response"></yp-ajax><yp-ajax id="pagesAjax" on-response="_pagesResponse"></yp-ajax></template><script>Polymer({is:"yp-community",behaviors:[Polymer.ypLanguageBehavior,Polymer.GroupCollectionBehaviors,Polymer.ypThemeBehavior,Polymer.CollectionHelpers,Polymer.AccessHelpers,Polymer.YpNewsTabSelected,Polymer.ypLoggedInUserBehavior,Polymer.ypDetectOldiOs,Polymer.ypGotoBehavior,Polymer.ypMediaFormatsBehavior],properties:{idRoute:Object,tabRoute:Object,idRouteData:Object,tabRouteData:Object,createFabIcon:{type:String,value:null,notify:!0},communityId:{type:Number,value:null,observer:"_communityIdChanged"},community:{type:Object},selectedTab:{type:String,value:"groups",observer:"_selectedTabChanged"},mapActive:{type:Boolean,value:!1},locationHidden:{type:Boolean,value:!1},useAlternativeHeader:{type:Boolean,value:!1},isOldiOs:{type:Boolean,computed:"_isOldiOs(communityId)"},useNormalHeader:{type:Boolean,value:!0}},observers:["_routeIdChanged(idRouteData.id)","_routeTabChanged(tabRouteData.tabName)"],listeners:{"yp-new-group":"_newGroup"},_userLoggedIn:function(e){e&&this.community&&window.location.href.indexOf("/community/")>-1&&this.$$("#ajax").generateRequest()},_newPostForGroup:function(e){window.appGlobals.activity("open","newPost"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("postEdit",function(t){t.setup(null,!0,null),t.open("new",{groupId:e.id,group:e})}.bind(this))},_refreshTabsAndPages:function(){this.async(function(){var e=this.$$("#tabPages");e&&e.forceSynchronousItemUpdate();var t=this.$$("#paper_tabs");t&&(t.forceSynchronousItemUpdate(),t.notifyResize())},10)},_routeIdChanged:function(e){e&&this.set("communityId",e)},_routeTabChanged:function(e){e&&this.set("selectedTab",e)},_selectedTabChanged:function(e){this.community&&this.redirectTo("/community/"+this.community.id+"/"+e),"map"==e?this.set("mapActive",!0):this.set("mapActive",!1),e&&window.appGlobals&&window.appGlobals.activity("open","community_tab_"+e),this.async(function(){var e=this.$$("#communityNews");e&&e.fireResize()},300)},_hideEdit:function(){return!this.community||(!window.appUser.loggedIn()||window.appUser.user.id!=this.community.user_id)},_communityHeaderUrl:function(e){return this.getImageFormatUrl(e.CommunityHeaderImages,2)},_communityIdChanged:function(e,t){e&&(this.set("community",null),this.set("featuredGroups",null),this.set("activeGroups",null),this.set("archivedGroups",null),this.set("selectedTab","groups"),this._getCommunity())},_getCommunity:function(){this.$$("#ajax").url="/api/communities/"+this.communityId,this.$$("#ajax").retryMethodAfter401Login=this._getCommunity.bind(this),this.$$("#ajax").generateRequest()},_newGroup:function(){window.appGlobals.activity("open","newGroup"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("groupEdit",function(e){e.setup(null,!0,this._refreshAjax.bind(this)),e.open("new",{communityId:this.communityId,community:this.community})}.bind(this))},_pagesResponse:function(e,t){this.fire("yp-set-pages",t.response)},_response:function(e,t,i){this.set("community",t.response),this.refresh(),this.community.only_admins_can_create_groups&&!this.checkCommunityAccess(this.community)||this.set("createFabIcon","add");this._communityHeaderUrl(this.community);this.setupGroups(this.community.Groups),this._setLocationHidden(this.community.Groups),this.async(function(){var e=this.$$("#communityCard");e&&(e.setElevation(5),e.lowerCardLater())},20)},_gotAdminRights:function(e,t){t&&t>0&&this.checkCommunityAccess(this.community)&&this.set("createFabIcon","add")},_setLocationHidden:function(e){var t=!0;e.forEach(function(e){e.configuration&&e.configuration.locationHidden?1!=e.configuration.locationHidden&&(t=!1):t=!1}.bind(this)),this.set("locationHidden",t),this._refreshTabsAndPages()},refresh:function(){this.community&&(this.fire("yp-set-home-link",{type:"community",id:this.community.id,name:this.community.name}),window.appGlobals.setCommunityAnalyticsTracker(this.community.google_analytics_code),this.community.configuration&&window.appGlobals.setCommunityPixelTracker(this.community.configuration.facebookPixelId),null!=this.community.theme_id?this.setTheme(this.community.theme_id):null!=this.community.Domain.theme_id&&this.setTheme(this.community.Domain.theme_id),null!=this.community.default_locale&&window.appGlobals.changeLocaleIfNeeded(this.community.default_locale),this.community.configuration&&this.community.configuration.alternativeHeader&&""!=this.community.configuration.alternativeHeader?(this.set("useAlternativeHeader",!0),this.set("useNormalHeader",!1)):(this.set("useAlternativeHeader",!1),this.set("useNormalHeader",!0)),this.community.CommunityHeaderImages&&this.community.CommunityHeaderImages.length>0?this.$.page.setupTopHeaderImage(this.community.CommunityHeaderImages):this.$.page.setupTopHeaderImage(null),this.fire("change-header",{headerTitle:this.community.Domain.name,headerDescription:this.community.Domain.description,headerIcon:"group-work",disableDomainUpLink:this.community.configuration&&!0===this.community.configuration.disableDomainUpLink,documentTitle:this.community.name,backPath:"/domain/"+this.community.domain_id}),this.$.pagesAjax.url="/api/communities/"+this.community.id+"/pages",this.$.pagesAjax.generateRequest(),window.appGlobals.setAnonymousGroupStatus(null),window.appGlobals.disableFacebookLoginForGroup=!1,window.appGlobals.externalGoalTriggerUrl=null,window.appGlobals.currentGroupForceSaml=!1,this.community.configuration&&this.community.configuration.signupTermsPageId&&-1!=this.community.configuration.signupTermsPageId?window.appGlobals.signupTermsPageId=this.community.configuration.signupTermsPageId:window.appGlobals.signupTermsPageId=null)},defaultGroupFirst:function(e){for(var t=[],i=null,o=0;o<e.length;o++){var n=e[o];"default"!=n.short_name?t.push(n):i=n}return t.unshift(i),t},noTestGroup:function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i];"test"!=o.short_name&&"ac-posts"!=o.short_name&&"development"!=o.short_name&&-1==o.short_name.indexOf("2012")&&-1==o.short_name.indexOf("2013")&&t.push(o)}return t},_refreshAjax:function(){this.async(function(){this.$$("#ajax").generateRequest()},100)},ready:function(){}});</script></dom-module>