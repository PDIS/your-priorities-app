<link rel="import" href="../../bower_components/polymer/polymer.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-image/iron-image.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html?v=8.0.0-4"><link rel="import" href="../../bower_components/lite-signal/lite-signal.html?v=8.0.0-4"><link rel="import" href="../../bower_components/neon-animation/web-animations.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-material/paper-material.html?v=8.0.0-4"><link rel="import" href="../yp-app-globals/yp-app-icons.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-language-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/access-helpers.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-got-admin-rights-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-truncate-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-large-card-behaviors.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-goto-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-media-formats-behavior.html?v=8.0.0-4"><link rel="import" href="yp-community-behaviors.html?v=8.0.0-4"><link rel="import" href="yp-community-stats.html?v=8.0.0-4"><link rel="import" href="../yp-magic-text/yp-magic-text.html?v=8.0.0-4"><dom-module id="yp-community-large-card"><template><style include="iron-flex iron-flex-alignment">.communityAccess{padding-bottom:8px}.description{line-height:var(--description-line-height,1.3)}.stats{position:absolute;bottom:0;right:8px}.community-name{padding:0;padding-bottom:4px;padding-right:1px;margin:0;font-size:24px;font-weight:700}iron-image,video{width:432px;height:243px}.large-card{background-color:#fefefe;color:#333;height:243px;width:432px;padding:0!important;margin-top:0!important}.image{width:432px;height:243px}.description-and-stats{width:100%}.edit{color:#FFF;position:absolute;top:0;left:390px;padding-right:0;margin-right:0}.contentContainer{@apply --layout-horizontal;}.description-and-stats{padding-bottom:32px}.description{padding:0;margin:0}.communityDescription{padding-left:16px;padding-right:16px;padding-top:16px}.community-name{background-color:var(--primary-color-800,#000);color:#fafafa;padding-left:16px;padding-top:16px;padding-bottom:16px;min-height:31px}.textBox{margin-left:32px;position:relative}#welcomeHTML{width:432px;max-width:432px;overflow:hidden}.k2017Image{height:72px}.k2017FeaturedImage{height:85px}.k2017extraMargin{margin-right:68px;margin-left:45px}.k2017topPadding{padding:8px}.k2017topPadding a:link{color:#333}.k2017topPadding a:visited{color:#333}.k2017showOnlyMobile{display:none}@media (max-width:945px){:host{width:306px}.k2017Image{height:42px}.k2017FeaturedImage{height:55px}.k2017extraMargin{margin-right:52px;margin-left:32px}.k2017topPadding{padding-top:4px}.k2017hiddenMobile{display:none}.k2017showOnlyMobile{display:inline}#welcomeHTML{width:306px;max-width:306px}.large-card{width:306px;height:100%}.top-card{margin-bottom:16px}.edit{left:265px}iron-image,video{width:306px;height:172px!important}.image{width:306px;height:172px!important}.imageCard{height:172px!important}.community-name{font-size:20px;min-height:26px}.communityDescription{padding-top:6px;padding-bottom:4px}.textBox{margin-left:0}}[hidden]{display:none!important}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><div class="layout horizontal wrap"><paper-material id="cardImage" elevation="3" animated="" class="large-card imageCard top-card"><div id="welcomeHTML" hidden$="[[!community.configuration.welcomeHTML]]" class="layout vertical center-center"></div><div hidden$="[[community.configuration.welcomeHTML]]"><template is="dom-if" if="[[communityVideoURL]]" restamp=""><video id="videoPlayer" controls="" class="image pointer" src="[[communityVideoURL]]"></video></template><template is="dom-if" if="[[!communityVideoURL]]"><iron-image class="image" sizing="cover" src$="[[communityLogoImagePath]]"></iron-image></template></div></paper-material><paper-material id="card" elevation="3" animated="" class="large-card textBox"><div class="layout vertical"><div class="layout horizontal wrap"><div class="layout vertical description-and-stats"><div class="description"><div class="community-name"><yp-magic-text text-type="communityName" content-language="[[community.language]]" disable-translation="[[community.configuration.disableNameAutoTranslation]]" text-only="" content="[[communityNameFull]]" content-id="[[community.id]]"></yp-magic-text></div><div hidden="" class="communityAccess">[[_communityAccessText(community.access)]]</div><yp-magic-text id="description" class="communityDescription" text-type="communityContent" content-language="[[community.language]]" content="[[community.description]]" content-id="[[community.id]]"></yp-magic-text></div></div></div><paper-menu-button class="edit" vertical-align="top" horizontal-align="[[editMenuAlign]]" hidden$="[[!showMenuItem]]"><paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content" on-iron-select="_menuSelection"><paper-item hidden$="[[!hasCommunityAccess]]" id="editMenuItem">[[t('community.edit')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="usersMenuItem">[[t('community.users')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="adminsMenuItem">[[t('community.admins')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="pagesMenuItem">[[t('pages.managePages')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="deleteMenuItem">[[t('community.delete')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="anonymizeMenuItem">[[t('anonymizeCommunityContent')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="deleteContentMenuItem">[[t('deleteCommunityContent')]]</paper-item><paper-item hidden$="[[!hasCommunityAccess]]" id="bulkStatusUpdateMenuItem">[[t('bulkStatusUpdate')]]</paper-item><paper-item id="addGroupMenuItem">[[t('group.new')]]</paper-item></paper-listbox></paper-menu-button></div><yp-community-stats class="stats" community="[[community]]"></yp-community-stats></paper-material></div><iron-media-query query="(max-width: 800px)" query-matches="{{narrowScreen}}"></iron-media-query><lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal><lite-signal on-lite-signal-yp-pause-video="_pauseVideo"></lite-signal></template><script>Polymer({is:"yp-community-large-card",behaviors:[Polymer.ypLanguageBehavior,Polymer.CommunityBehaviors,Polymer.LargeCardBehaviors,Polymer.AccessHelpers,Polymer.ypGotAdminRightsBehavior,Polymer.ypGotoBehavior,Polymer.ypTruncateBehavior,Polymer.ypMediaFormatsBehavior],properties:{community:{type:Object,observer:"_communityChanged"},hasCommunityAccess:{type:Boolean,value:!1,computed:"_hasCommunityAccess(community, gotAdminRights)"},showMenuItem:{type:Boolean,value:!1,computed:"_showMenuItem(hasCommunityAccess, community)"},communityVideoURL:{type:String,computed:"_communityVideoURL(community)"}},_pauseVideo:function(){var e=this.$$("#videoPlayer");e&&e.pause()},_communityVideoURL:function(e){return e&&e.configuration.useVideoCover&&e.CommunityLogoVideos&&e.CommunityLogoVideos.length>0&&e.CommunityLogoVideos[0].viewable?e.CommunityLogoVideos[0].formats[0]:null},_showMenuItem:function(e,t){return e||t&&!t.only_admins_can_create_groups},_communityChanged:function(e){e&&e.description&&(this.async(function(){if(e.configuration&&e.configuration.welcomeHTML&&""!==e.configuration.welcomeHTML&&this.$$("#welcomeHTML")){var t=document.createElement("div");t.innerHTML=e.configuration.welcomeHTML,this.$$("#welcomeHTML").innerHTML="",Polymer.dom(this.$$("#welcomeHTML")).appendChild(t)}else this.$$("#welcomeHTML")&&(this.$$("#welcomeHTML").innerHTML="")}),e.description.length>220&&e.name&&e.name.length>30?this.$$("#description").style.fontSize="15px":this.$$("#description").style.fontSize="16px")},_hasCommunityAccess:function(e,t){return!(!e||!t)&&null!=this.checkCommunityAccess(e)},_communityAccessText:function(e){switch(e){case 0:return this.t("community.public");case 1:return this.t("community.closed");case 2:return this.t("community.secret")}},_menuSelection:function(e,t){"editMenuItem"==t.item.id?this._openEdit():"deleteMenuItem"==t.item.id?this._openDelete():"usersMenuItem"==t.item.id?this._openUsersDialog():"adminsMenuItem"==t.item.id?this._openAdminsDialog():"pagesMenuItem"==t.item.id?this._openPagesDialog():"bulkStatusUpdateMenuItem"==t.item.id?this._openBulkStatusUpdates():"addGroupMenuItem"==t.item.id?this.fire("yp-new-group"):"anonymizeMenuItem"===t.item.id?this._openAnonymizeContent():"deleteContentMenuItem"===t.item.id&&this._openDeleteContent(),this.$$("paper-listbox").select(null)},_openBulkStatusUpdates:function(){window.appGlobals.activity("open","community.bulkStatusUpdates"),document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"open-bulk-status-updates",data:null}})),this.async(function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateGrid",function(e){e.open(this.community.id)}.bind(this))})},_openUsersDialog:function(){window.appGlobals.activity("open","community.users"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(null,this.community.id,null,!1),e.open(this.community.name)}.bind(this))},_openAdminsDialog:function(){window.appGlobals.activity("open","community.admins"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(null,this.community.id,null,!0),e.open(this.community.name)}.bind(this))},_openPagesDialog:function(){window.appGlobals.activity("open","community.pagesAdmin"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("pagesGrid",function(e){e.setup(null,this.community.id,null,!1),e.open()}.bind(this))},_openDelete:function(){window.appGlobals.activity("open","community.delete"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/communities/"+this.community.id,this.t("communityDeleteConfirmation"),this._onDeleted.bind(this)),e.open({finalDeleteWarning:!0})}.bind(this))},_openDeleteContent:function(){window.appGlobals.activity("open","community.deleteContents"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/communities/"+this.community.id+"/delete_content",this.t("communityDeleteContentConfirmation")),e.open({finalDeleteWarning:!0})}.bind(this))},_openAnonymizeContent:function(){window.appGlobals.activity("open","community.anonymize"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/communities/"+this.community.id+"/anonymize_content",this.t("communityAnonymizeConfirmation"),null,this.t("anonymize")),e.open({finalDeleteWarning:!0})}.bind(this))},_openEdit:function(){window.appGlobals.activity("open","community.edit"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("communityEdit",function(e){e.setup(this.community,!1,this._refresh.bind(this)),e.open("edit",{communityId:this.community.id})}.bind(this))},_onDeleted:function(){this.redirectTo("/domain/"+this.community.domain_id),this.dispatchEvent(new CustomEvent("yp-refresh-domain",{bubbles:!0,composed:!0}))},_refresh:function(e){e&&this.set("community",e),this.fire("update-community")}});</script></dom-module>