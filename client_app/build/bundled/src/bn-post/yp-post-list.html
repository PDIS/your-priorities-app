<link rel="import" href="../../bower_components/polymer/polymer.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-list/iron-list.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html?v=8.0.0-4"><link rel="import" href="../../bower_components/lite-signal/lite-signal.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-a11y-keys/iron-a11y-keys.html?v=8.0.0-4"><link rel="import" href="../yp-app-globals/yp-app-icons.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-language-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-iron-list-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-ajax/yp-ajax.html?v=8.0.0-4"><link rel="import" href="../yp-post/yp-post-card.html?v=8.0.0-4"><link rel="import" href="../yp-posts-filter/yp-posts-filter.html?v=8.0.0-4"><dom-module id="yp-post-list"><template><style include="iron-flex iron-flex-alignment">.container{@apply --layout-horizontal;@apply --layout-wrap;}.postsFilter{padding-left:16px;height:36px}.objectives{padding-bottom:40px;max-width:432px}.description{padding:12px}yp-post-card{padding-bottom:52px}#outerRegion{position:relative;@apply --layout-vertical;}iron-list{height:100vh}yp-ajax{padding-top:48px}yp-posts-filter{margin-bottom:8px;margin-left:8px;margin-top:16px}.searchButton{padding:8px;margin:8px}.searchContainer{margin-top:8px}yp-posts-filter{padding-right:16px}.half{width:50%}.searchBox{--paper-input-container-label:{font-size:22px;color:#555};margin-bottom:22px;margin-right:8px}@media (max-width:800px){.searchBox{--paper-input-container-label:{font-size:17px};margin-bottom:8px}.half{width:100%}.searchContainer{@apply --layout-center-center;}}.noIdeas{background-color:#FFF;max-width:200px;padding:16px;margin:16px;margin-top:32px}.noIdeasText{font-weight:700}.card{padding:0;padding-top:8px}.card[wide-padding]{padding:16px!important}#searchInput{margin-left:8px}[hidden]{display:none!important}:focus{outline:0}.largeAjax{position:absolute;bottom:32px}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query><iron-a11y-keys id="a11y" target="[[searchTarget]]" keys="enter" on-keys-pressed="_search"></iron-a11y-keys><div class="layout vertical center-center"><div class="searchContainer layout horizontal wrap" hidden$="[[group.configuration.hidePostFilterAndSearch]]"><div class="layout horizontal center-center"><yp-posts-filter on-tap="_tapOnFilter" sub-title="{{subTitle}}" class="filter" id="postsFilter" tab-name="[[statusFilter]]" on-refresh-group="_refreshGroupFromFilter" group="[[group]]" filter="{{filter}}" searching-for="{{searchingFor}}" category-id="{{categoryId}}" category-name="{{categoryName}}" posts-count="{{postsCount}}"></yp-posts-filter></div><div class="layout horizontal center-center"><paper-input id="searchInput" label$="[[t('searchFor')]]" value="{{searchingFor}}" class="searchBox"></paper-input><paper-icon-button icon="search" on-tap="_search" hidsden$="[[!showSearchIcon]]"></paper-icon-button></div></div><template is="dom-if" if="[[noPosts]]" restamp=""><div class="layout horiztonal center-center"><paper-material class="noIdeas layout horizontal center-center" elevation="2"><div class="noIdeasText">[[t('noIdeasHere')]]</div></paper-material></div></template><div class="layout horizontal center-center"><iron-list id="ironList" scroll-offset="550" items="[[posts]]" as="post" scroll-target="document" grid=""><template><div tabindex$="[[tabIndex]]" wide-padding$="[[wide]]" class="card layout vertical center-center"><yp-post-card class="card" post="[[post]]" on-mouseover="cardMouseOver" on-mouseout="cardMouseOut"></yp-post-card></div></template></iron-list></div><div class="layout horizontal center-center largeAjax"><yp-ajax id="ajax" large-spinner="" on-response="_postsResponse"></yp-ajax></div></div></template><script>Polymer({is:"yp-post-list",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypIronListBehavior],properties:{categories:{type:Array},subTitle:{type:String,notify:!0},defaultCategories:{type:Boolean,value:!1},posts:{type:Array,value:null,notify:!0},groupId:{type:Number,observer:"_groupIdChanged"},userId:{type:Number},group:{type:Object,notify:!0,observer:"_groupChanged"},filter:{type:String,value:"newest",observer:"_filterChanged"},statusFilter:{type:String,value:"open",notify:!0},categoryId:{type:String,observer:"_categoryIdChanged"},postsCount:{type:Number,notify:!0},searchTarget:{type:Object,computed:"_searchTarget(noPosts)"},categoryName:{type:String},searchingFor:{type:String,value:null,observer:"_searchingForChanged"},selectedCategoryName:{type:String},selectedTab:{type:String,observer:"_selectedTabChanged"},tabCounterId:{type:String},oldestPostAt:{type:Date},noPosts:{type:Boolean,value:!1},wideListOffset:{type:Number,value:610},listOffset:{type:String,value:"500px"},showSearchIcon:{type:Boolean,value:!1},randomSeed:{type:Number,value:null}},_tapOnFilter:function(){window.appGlobals.activity("click","filter")},_searchTarget:function(t){t||this.async(function(){return this.$$("#searchInput")})},_selectedTabChanged:function(t){this.statusFilter},_search:function(){window.appGlobals.activity("click","search"),this.searchingFor&&""!=this.searchingFor&&this._refreshGroupFromFilter()},cardMouseOver:function(t){t.currentTarget.elevation=4},cardMouseOut:function(t){t.currentTarget.elevation=1},buildPostsUrlPath:function(){return this.$.postsFilter.buildPostsUrlPath()},_searchingForChanged:function(t,e){this.set("moreToLoad",!0),t&&""!=t?this.set("showSearchIcon",!0):this.set("showSearchIcon",!1)},_filterChanged:function(t,e){this.set("moreToLoad",!0)},_categoryIdChanged:function(t,e){this.set("moreToLoad",!0)},ready:function(){},_groupIdChanged:function(t,e){},_groupChanged:function(t){this.set("posts",null),this.set("noPosts",!1),this.set("randomSeed",Math.random()),t&&(this.set("moreToLoad",!0),t.configuration&&void 0!=t.configuration.canAddNewPosts?!0===t.configuration.canAddNewPosts?this.set("filter","newest"):!1===t.configuration.canAddNewPosts&&!1===t.configuration.canVote?this.set("filter","top"):this.set("filter","random"):this.filter||this.set("filter","newest"),this._loadMoreData())},_refreshGroupFromFilter:function(){this.set("posts",null),this.set("moreToLoad",!0),this._loadMoreData()},_loadMoreData:function(){var t,e;this.moreToLoad&&this.group&&(console.info("_loadMoreData for groupId: "+this.groupId+" statusFilter: "+this.statusFilter),this.set("moreToLoad",!1),this.set("noPosts",!1),this.userId?(t=this.userId+"/posts",e="users"):(t=this.groupId,e="groups"),this.searchingFor?this.$$("#ajax").url="/api/"+e+"/"+t+"/search/"+this.searchingFor:(this.$$("#ajax").url="/api/"+e+"/"+t+"/posts/"+this.filter,this.categoryId?this.$$("#ajax").url+="/"+this.categoryId:this.$$("#ajax").url+="/null",this.$$("#ajax").url+="/"+this.statusFilter),this.$$("#ajax").url+="?offset="+(null!=this.posts?this.posts.length:0),this.randomSeed&&(this.$$("#ajax").url+="&randomSeed="+this.randomSeed),this.$$("#ajax").generateRequest())},_postsResponse:function(t,e,s){var o=e.response.posts;if(this.set("postsCount",e.response.totalPostsCount),this.fire("yp-post-count",{tabCounterId:this.tabCounterId,count:this.postsCount}),this.posts)for(var r=0;r<o.length;r++)this.push("posts",o[r]);else this.set("posts",o);0!=o.length||null!=this.posts&&0!=this.posts.length||this.set("noPosts",!0),o.length>0?this.set("noPosts",!1):this.searchingFor&&""!=this.searchingFor&&this.set("noPosts",!1),this.async(function(){var t=this.$$("#postsFilter");t&&t._updateTitle()},20),this.async(function(){this.$$("#ironList").fire("iron-resize")}),o.length>0&&o.length!=this.postsCount&&this.set("moreToLoad",!0),document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"yp-refresh-activities-scroll-threshold",data:{}}})),this._processCategories()},_processCategories:function(){if(this.categoryId&&this.group)for(var t=0;t<this.group.Categories.length;t++)this.group.Categories[t].id==this.categoryId&&(this.selectedCategoryName=this.group.Categories[t].name);else this.selectedCategoryName="categories.all"}});</script></dom-module>