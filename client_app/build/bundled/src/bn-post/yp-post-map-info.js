Polymer({is:"yp-post-map-info",properties:{elevation:{type:Number,notify:!0,value:4},fadeIn:{type:Boolean,notify:!0,value:!1},isShowing:{type:Boolean,notify:!0,value:!1},_dim:{type:Object,notify:!0},map:{type:Object,notify:!0,observer:"_mapChanged"},_mapListeners:{type:Array,notify:!0,value:[]},_marker:{type:Object,notify:!0},_overlay:{type:Object,notify:!0},_bk:{type:Object},_nbk:{type:Object},_isCustomBeak:{type:Boolean,notify:!0,value:!1},_watchingSize:{type:Boolean,notify:!0,value:!1}},close:function(){this._releaseListeners(),this.isShowing=!1,this.$.infocarddiv.style.opacity=0,this.$.infocarddiv.style.left=0,this.$.infocarddiv.style.display="none",this.$.stdbeak.style.display="none",this.$.custombeak.style.display="none",this.$.stdbeak.style.opacity=0,this.$.custombeak.style.opacity=0},_contentChanged:function(){if(this.isShowing){this._getInfowindowSize();var i=this._setInfowindowPosition();this._placementInBounds(i)||this._panToShowInfowindow(i)}},detached:function(){this._releaseListeners(),this.isShowing=!1,this.$.infocarddiv.style.left=0,this.$.infocarddiv.style.opacity=this.fadeIn?0:1,this.$.infocarddiv.style.display="none",this.$.stdbeak.display="none",this.$.custombeak.display="none",this.$.stdbeak.opacity=0,this.$.custombeak.opacity=0,this._marker=void 0,this.map=void 0},_doFadeIn:function(){var i=this;if(this.isShowing){var t=parseFloat(this.$.infocarddiv.style.opacity);t>=.9?this.$.infocarddiv.style.opacity="1":(t+=.1,this.$.infocarddiv.style.opacity=t.toString(),setTimeout(function(){i._doFadeIn()},40))}},_getInfowindowSize:function(){var i=this.$.infocarddiv;this._dim.card.width=i.offsetWidth,this._dim.card.height=i.offsetHeight,this._isCustomBeak?(this._dim.beak.height=this._bk.offsetHeight,this._dim.beak.width=this._bk.offsetWidth,this._dim.customBeak=!0):(this._dim.beak={height:20,width:20},this._dim.customBeak=!1)},_getMarkerSize:function(){if(this._marker&&this._marker.getIcon()){var i=this._marker.getIcon();this._dim.marker.y=i.anchor.y,this._dim.marker.x=0}else this._dim.marker={x:0,y:42}},_getMapSize:function(){var i=this.map.getDiv();this._dim.map.width=i.offsetWidth,this._dim.map.height=i.offsetHeight},_initListeners:function(){var i=this;this._mapListeners=[],this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map);this._mapListeners.push(google.maps.event.addListener(this.map,"projection_changed",function(){i._overlay=new google.maps.OverlayView,i._overlay.draw=function(){},i._overlay.setMap(i.map)})),this._mapListeners.push(google.maps.event.addListener(this.map,"zoom_changed",function(t){i.isShowing&&(i._getInfowindowSize(),i._setInfowindowPosition())})),this._mapListeners.push(google.maps.event.addListener(this.map,"center_changed",function(t){i.isShowing&&i.isShowing&&(i._getInfowindowSize(),i._setInfowindowPosition())})),this._mapListeners.push(google.maps.event.addListener(this._marker,"drag",function(t){i.isShowing&&i._setInfowindowPosition()})),this._watchingSize},_mapChanged:function(i,t){this.map&&(this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map))},_panToShowInfowindow:function(i){var t={x:0,y:0};i.left<0?t.x=i.left-10:i.left+this._dim.card.width>this._dim.map.width&&(t.x=i.left+this._dim.card.width-this._dim.map.width+10),i.top<0?t.y=i.top-10:i.top+this._dim.card.height+this._dim.marker.y+10>this._dim.map.height&&(t.y=i.top+this._dim.card.height+this._dim.marker.y-this._dim.map.height+20),0==t.x&&0==t.y||this.map.panBy(t.x,t.y)},_placementInBounds:function(i){return i.top>=0&&i.left>=0&&i.left+this._dim.card.width<this._dim.map.width&&i.top+this._dim.card.height+this._dim.marker.y+10<this._dim.map.height},ready:function(){this.set("_dim",{card:{height:10,width:10},map:{height:100,width:100},marker:{x:0,y:42},beak:{width:20,height:20,customBeak:!1}}),this.map&&(this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map))},_releaseListeners:function(){for(var i=0,t=this._mapListeners;i<t.length;i++){var e=t[i];google.maps.event.removeListener(e)}this._mapListeners=[]},_setInfowindowPosition:function(){this._overlay||(this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map),console.log("overlay not set"));var i={left:0,top:0};try{var t=this._overlay.getProjection().fromLatLngToContainerPixel(this._marker.getPosition()),e=Math.round(t.x-this._dim.card.width/2),s=Math.round(t.y-this._dim.card.height-this._dim.marker.y-this._dim.beak.height+10);this.$.infocarddiv.style.left=e+"px",this.$.infocarddiv.style.top=s+"px",this._bk.style.left=t.x-this._dim.beak.width/2+"px",this._bk.style.top=Math.floor(s-10+this._dim.card.height)+"px",i={left:e,top:s}}catch(i){console.log("setInfowindowPosition error"),console.log(i)}return i},showInfoWindow:function(i){var t=this;this.map&&i&&(this.isShowing&&this.close(),this._marker=i,this._getMapSize(),this._getMarkerSize(),this.$.infocarddiv.style.display="block",Polymer.dom(this.$.custombeakcontent).getDistributedNodes().length>0?(this._bk=this.$.custombeak,this._nbk=this.$.stdbeak,this._isCustomBeak=!0):(this._bk=this.$.stdbeak,this._nbk=this.$.custombeak,this._isCustomBeak=!1),this._bk.style.opacity="0",this._bk.style.display="block",this._nbk.style.opacity="0",this._nbk.style.display="none",setTimeout(function(){t._getInfowindowSize();var i=t._setInfowindowPosition();t.$.infocarddiv.style.opacity=t.fadeIn?0:1,t._bk.style.opacity="1",t._initListeners(),t.isShowing=!0,t.fadeIn&&t._doFadeIn(),t._placementInBounds(i)||t._panToShowInfowindow(i)},33))}});