<link rel="import" href="../../bower_components/polymer/polymer.html?v=8.0.0.4"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html?v=8.0.0.4"><link rel="import" href="../../bower_components/lite-signal/lite-signal.html?v=8.0.0.4"><link rel="import" href="../../bower_components/paper-tabs/paper-tab.html?v=8.0.0.4"><link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html?v=8.0.0.4"><link rel="import" href="../yp-behaviors/yp-language-behavior.html?v=8.0.0.4"><link rel="import" href="../yp-behaviors/yp-media-formats-behavior.html?v=8.0.0.4"><link rel="import" href="../yp-theme/yp-theme-behavior.html?v=8.0.0.4"><link rel="import" href="../yp-post/yp-post-map.html?v=8.0.0.4"><link rel="import" href="../yp-ajax/yp-ajax.html?v=8.0.0.4"><link rel="import" href="../yp-page/yp-page.html?v=8.0.0.4"><link rel="import" href="../yp-behaviors/yp-goto-behavior.html?v=8.0.0.4"><link rel="import" href="yp-organization-large-card.html?v=8.0.0.4"><dom-module id="yp-organization"><template><style include="iron-flex iron-flex-alignment">.card-container{@apply --layout-horizontal;@apply --layout-wrap;width:100%}.card{padding:16px}yp-ajax{background-color:var(--primary-background-color)}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><yp-page id="page" create-fab-icon="group" create-fab-title="[[t('group.add')]]" on-yp-create-fab-tap="_newGroup"><yp-organization-large-card id="organizationCard" slot="largeCard" class="largeCard card" organization="[[organization]]" on-update-organization="_refresh"></yp-organization-large-card><paper-tabs id="paper_tabs" slot="tabs" class="tabs" selected="{{selected}}" focused=""><paper-tab class="tab"><span>[[t('groups')]]</span> &nbsp; (<span>[[groups.length]]</span>)</paper-tab><paper-tab class="tab">[[t('news')]]</paper-tab><paper-tab class="tab">[[t('posts.map')]]</paper-tab></paper-tabs><iron-pages class="tabPages" slot="tabPages" selected="{{selected}}" entry-animation="fade-in-animation" exit-animation="fade-out-animation"><section><div class="layout horizontal center-center wrap"></div></section><section><template is="dom-if" if="[[mapActive]]" restamp=""><yp-post-map organization-id="[[organization.id]]"></yp-post-map></template></section></iron-pages></yp-page><yp-ajax id="ajax" url="/api/organizations" on-response="_response"></yp-ajax></template><script>Polymer({is:"yp-organization",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypThemeBehavior,Polymer.ypGotoBehavior,Polymer.ypMediaFormatsBehavior],properties:{groups:{type:Array},organizationId:{type:Number,value:null,observer:"_organizationIdChanged"},organization:{type:Object},organizationEmpty:{type:Boolean,value:!1},hideAdd:{type:Boolean,value:!0},selected:{type:Number,value:0,observer:"_selectedChanged"},tabName:{type:String,value:null,observer:"_tabNameChanged"},mapActive:{type:Boolean,value:!1}},_tabNameChanged:function(e){e&&("groups"==e?this.set("selected",0):"news"==e?this.set("selected",1):"map"==e&&this.set("selected",2))},_selectedChanged:function(e){this.organization&&(0==e?this.redirectTo("/organization/"+this.organization.id+"/groups"):1==e?this.redirectTo("/organization/"+this.organization.id+"/news"):2==e&&this.redirectTo("/organization/"+this.organization.id+"/map"))},_hideEdit:function(){return!this.organization||(!window.appUser.loggedIn()||window.appUser.user.id!=this.organization.user_id)},_organizationHeaderUrl:function(e){return this.getImageFormatUrl(e.OrganizationHeaderImages,2)},_organizationIdChanged:function(e,i){e&&(this.set("organization",null),this.set("groups",null),this.$$("#ajax").url="/api/organizations/"+this.organizationId,this.$$("#ajax").generateRequest(),this.hideAdd=!0)},_newGroup:function(){window.appGlobals.activity("open","newGroup"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("groupEdit",function(e){e.setup(null,!0,null),e.open("new",{organizationId:this.organizationId})}.bind(this))},_response:function(e,i,t){this.set("organization",i.response),this.organization.OrganizationHeaderImages&&this.organization.OrganizationHeaderImages.length>0&&this.$.page.setupTopHeaderImage(this.organization.OrganizationHeaderImages);Math.floor(3*Math.random()),this._organizationHeaderUrl(this.organization);this.set("groups",this.organization.Groups),this.async(function(){var e=this.$$("#organizationCard");e&&(e.setElevation(5),e.lowerCardLater())},20),0===i.response.Groups.length?this.organizationEmpty=!0:this.organizationEmpty=!1,this.fire("change-header",{headerTitle:this.organization.Domain.name,headerDescription:this.organization.Domain.description,headerIcon:"group-work",backPath:"/domain/"+this.organization.domain_id}),this.groups.length>0?this.hideAdd=!0:this.hideAdd=!1},defaultGroupFirst:function(e){for(var i=[],t=null,a=0;a<e.length;a++){var n=e[a];"default"!=n.short_name?i.push(n):t=n}return i.unshift(t),i},noTestGroup:function(e){for(var i=[],t=0;t<e.length;t++){var a=e[t];"test"!=a.short_name&&"ac-posts"!=a.short_name&&"development"!=a.short_name&&-1==a.short_name.indexOf("2012")&&-1==a.short_name.indexOf("2013")&&i.push(a)}return i},_refresh:function(){this.$$("#ajax").generateRequest()},ready:function(){}});</script></dom-module>