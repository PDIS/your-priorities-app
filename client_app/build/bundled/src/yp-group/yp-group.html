<div hidden="" by-polymer-bundler=""><dom-module id="yp-post-card-add" assetpath="../yp-post/"><template><style include="iron-flex iron-flex-alignment">:host{margin-top:8px}.postCard{width:280px;min-height:80px;height:100%;margin-top:8px;padding:16px;background-color:var(--accent-color);color:#FFF;font-size:16px;cursor:pointer;margin-bottom:8px}iron-icon{height:80px;width:80px;color:#FFF}.header{padding:0;margin:0;padding-top:16px}.icon{--iron-icon-height:140px;--iron-icon-width:140px}.half{width:50%}.addText{padding-left:0;padding-right:8px}iron-icon{width:64px;height:64px;margin-right:8px;margin-left:0}.addNewIdeaText{font-size:26px;width:100%;color:#FFF}.closed{font-size:18px;padding:8px}@media (max-width:832px){.postCard{width:100%;margin-left:64px;margin-right:64px}}paper-card[disabled]{background-color:#888;cursor:initial;max-width:250px;width:220px;padding:8px;margin-top:4px;min-height:initial}iron-icon[disabled]{height:36px;width:36px}@media (max-width:420px){.postCard{max-width:250px;width:250px;margin-left:0;margin-right:0;margin-bottom:4px;padding:8px;min-height:64px}.addNewIdeaText{font-size:20px;width:100%}iron-icon{height:48px;width:48px}.closed{font-size:17px}}[hidden]{display:none!important}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><div class="layout vertical center-center"><paper-card disabled$="[[disabled]]" elevation="[[elevation]]" class="postCard" on-tap="_newPost"><div class="layout horizontal center-center addNewIdeaText"><iron-icon disabled$="[[disabled]]" icon="lightbulb-outline"></iron-icon><div class="flex addText" hidden$="[[disabled]]">[[t('post.add_new')]]</div><div class="flex addText closed" hidden$="[[!disabled]]">[[t('closedForNewPosts')]]</div></div></paper-card></div></template><script>Polymer({is:"yp-post-card-add",properties:{elevation:{type:Number},disabled:{type:Boolean}},_newPost:function(){this.disabled||this.fire("new-post")},behaviors:[Polymer.ypLanguageBehavior]});</script></dom-module><dom-module id="yp-posts-filter" assetpath="../yp-posts-filter/"><template><style include="iron-flex iron-flex-alignment">:host{padding-bottom:0!important;margin-bottom:0!important}paper-menu-button{padding:0;margin:0}.filterIcon{padding-right:8px}.filterIconTransform{-moz-transform:scaleY(-1);-o-transform:scaleY(-1);-webkit-transform:scaleY(-1);transform:scaleY(-1);filter:FlipV;-ms-filter:"FlipV"}.dropdown-trigger{margin-bottom:16px;margin-left:16px}.clear-search-trigger{width:55px;height:55px;margin-bottom:16px}paper-item{min-height:32px}.subTitle{font-size:22px;margin-top:10px;margin-right:8px}#filterDropdown{padding-left:0;margin-left:0}@media (max-width:600px){.subTitle{font-size:17px;padding-top:0;margin-top:16px}.dropdown-trigger{padding-left:0;margin-left:0;margin-bottom:0;margin-top:0}.clear-search-trigger{width:50px;height:50px;margin-top:5px;margin-bottom:0;margin-top:0}}paper-dropdown-menu{padding-left:8px;padding-right:8px;background-color:var(--primary-background-color)}.filterHeader{margin-top:16px;padding-bottom:0;margin-bottom:0;font-weight:700;font-size:18px}.categoriesDropdownMenu{padding-left:16px;parring-right:16px}#dropDownTrigger{background-color:var(--accent-color);margin-left:16px;color:#FFF}.dropdownIcon{color:#FFF;margin-right:8px;margin-left:8px}.catImage{width:24px;height:24px;margin-right:8px}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><template is="dom-if" if="[[group]]"><div class="layout horizontal center-center mainContainer wrap"><template is="dom-if" if="[[showFilter]]"><paper-menu-button id="filterDropdown" class="selected-items" icon="sort" vertical-align="auto" horizontal-align="right"><paper-button raised="" title$="[[t('filterIdeas')]]" id="dropDownTrigger" icon="sort" slot="dropdown-trigger"><iron-icon icon="sort" class="dropdownIcon"></iron-icon>{{t('filterIdeas')}}</paper-button><div slot="dropdown-content" class="layout vertical"><div><div class="filterHeader layout horizontal center-center">[[t('filterIdeas')]]</div><template is="dom-if" if="[[categoriesWithCount]]" restamp=""><div class="layout vertical"><paper-dropdown-menu class="dropdown-content wrap categoriesDropdownMenu"><paper-listbox slot="dropdown-content" id="categoryMenu" attr-for-selected="data-category-id" on-iron-select="_changeCategory"><paper-item data-category-id="-1" name="-1"><iron-icon icon="select-all" class="filterIcon"></iron-icon><span>[[t('categories.the_all')]] ([[allPostCount]])</span></paper-item><template is="dom-repeat" items="[[categoriesWithCount]]" as="category"><paper-item data-category-id$="[[category.id]]" data-category-name$="[[category.name]]"><iron-image sizing="cover" class="catImage" height="24" width="24" src="[[_categoryImageSrc(category)]]"></iron-image>[[category.name]] ([[category.count]])</paper-item></template></paper-listbox></paper-dropdown-menu></div></template><div class="layout horizontal center-center"><yp-ajax id="categoriesWithCountAjax" on-response="_categoriesCountResponse"></yp-ajax></div><paper-listbox slot="dropdown-content" id="mainListMenu" on-iron-select="_changeFilter"><paper-item data-filter="top"><iron-icon icon="trending-up" class="filterIcon"></iron-icon><span>[[t('post.top')]]</span></paper-item><paper-item data-filter="newest"><iron-icon icon="new-releases" class="filterIcon"></iron-icon><span>[[t('post.newest')]]</span></paper-item><paper-item data-filter="most_debated"><iron-icon icon="chat-bubble-outline" class="filterIcon"></iron-icon><span>[[t('post.most_debated')]]</span></paper-item><paper-item data-filter="random"><iron-icon icon="cached" class="filterIcon"></iron-icon><span>[[t('post.random')]]</span></paper-item></paper-listbox></div></div></paper-menu-button></template><template is="dom-if" if="[[searchingFor]]"><paper-icon-button icon="clear" on-tap="_clearSearch" class="clear-search-trigger"></paper-icon-button></template></div></template></template><script>Polymer({is:"yp-posts-filter",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypGotoBehavior,Polymer.ypImageFormatsBehavior],properties:{filter:{type:String,value:"newest",notify:!0,observer:"_filterChanged"},filterName:{type:String},categoryId:{type:String,notify:!0,observer:"_categoryIdChanged"},categoryName:{type:String},group:{type:Object,observer:"_groupChanged"},subTitle:{type:String,value:"",notify:!0},searchingFor:{type:String,value:null,notify:!0,observer:"_searchingForChanged"},showFilter:{type:Boolean,value:!0},postsCount:{type:Number,notify:!0},tabName:{type:String,observer:"_tabNameChanged"},categoriesWithCount:{type:Array,value:null},allPostCount:{type:Number,value:0}},observers:["_listLanguageChanged(language)"],_getCategoryCount:function(t,e){var i=__.find(e,function(e){return e.category_id==t});return i?i.count:0},_oldCategory:function(t){return!t||t.id<804},_categoriesCountResponse:function(t,e){var i=e.response.categoriesCount;this.set("allPostCount",e.response.allPostCount);var r=[];__.each(this.group.Categories,function(t){t.count=this._getCategoryCount(t.id,i),t.count>0&&r.push(t)}.bind(this)),r.length>1?(this.set("categoriesWithCount",r),this.async(function(){var t=this.$$("#categoryMenu");t?t.selected="-1":console.error("Cant set category menu")})):console.error("Unexpected categories count")},_openDropDown:function(){var t=this.$$("#dropDownTrigger");t&&t.click()},_searchingForChanged:function(t,e){this.showFilter=!0},_clearSearch:function(){this.set("searchingFor",null),this.set("filter","newest"),this._updateAfterFiltering()},openFilter:function(){window.appGlobals.activity("open","filter")},_filterChanged:function(t,e){t&&(this.filterName="post."+this.filter,this._updateTitle())},_categoryIdChanged:function(t,e){t&&this._updateTitle()},_listLanguageChanged:function(t){t&&this.t&&this._updateTitle()},searchFor:function(t){this.set("searchingFor",t);var e="/group/"+this.group.id+"/open/"+this.group.name+"/search/"+this.searchingFor;window.appGlobals.activity("change","filter",e),this.redirectTo(e),this.fire("refresh-group")},_updateTitle:function(){if(this.searchingFor)this.set("subTitle",this.t("post.searchingFor")+this.searchingFor);else{var t,e=this.t(this.filterName);t=this.categoryName?this.categoryName:this.t("categories.the_all");this.t("short_word.in");this._ifCategories()?this.set("subTitle",e+" - "+t):this.set("subTitle",e)}},_changeFilter:function(t,e){this.set("filter",e.item.dataset.filter),this._updateAfterFiltering()},_changeCategory:function(t,e){var i=this.categoryId,r=e.item.dataset.categoryId;"-1"!=r?(this.set("categoryId",r),this.categoryName=e.item.dataset.categoryName):(this.set("categoryId",null),this.categoryName=null,this.$$("#categoryMenu").selected=null),this._updateTitle(),i!==this.categoryId&&this._updateAfterFiltering()},buildPostsUrlPath:function(){var t="/group/"+this.group.id+"/"+this.tabName;return this.filter&&(t+="/posts/"+this.filter),this.categoryId&&(t+="/"+this.categoryId+"/"+this.categoryName),t},_updateAfterFiltering:function(){this.filter||this.set("filter","newest");var t=this.buildPostsUrlPath();window.appGlobals.activity("change","filter",t),this.fire("refresh-group")},_ifCategories:function(){return!!this.group&&(this.group.Categories&&this.group.Categories.length>0)},resetSelection:function(){this.async(function(){this.$$("#categoryMenu")&&(this.$$("#categoryMenu").selected=null),this.$$("#mainListMenu")?this.$$("#mainListMenu").selected=null:console.error("Cant find mainListMenu menu")},100)},_tabNameChanged:function(t){0},_setupCategories:function(t,e){this.set("categoriesWithCount",null),this.async(function(){var i=this.$$("#categoriesWithCountAjax");i?(i.url="/api/groups/"+t.id+"/categories_count/"+e,i.generateRequest()):console.error("Can't find categories ajax.")},100)},_groupChanged:function(t){this.set("categoriesWithCount",null),this.set("allPostCount",0),this.set("categoryId",null),t&&(this._updateTitle(),t.Categories&&t.Categories.length>0&&this._setupCategories(t,this.tabName),this.resetSelection())},_categoryItems:function(){return this.group.Categories?this.splitArray(this.group.Categories,7):[]},_categoryImageSrc:function(t){return this.getImageFormatUrl(t.CategoryIconImages,0)},splitArray:function(t,e){return t.chunk(e)}});</script></dom-module><dom-module id="yp-post-list" assetpath="../yp-post/"><template><style include="iron-flex iron-flex-alignment">.container{@apply --layout-horizontal;@apply --layout-wrap;}.postsFilter{padding-left:16px;height:36px}.objectives{padding-bottom:40px;max-width:432px}.description{padding:12px}yp-post-card{padding-bottom:52px}#outerRegion{position:relative;@apply --layout-vertical;}iron-list{height:100vh}yp-ajax{padding-top:48px}yp-posts-filter{margin-bottom:8px;margin-left:8px;margin-top:16px}.searchButton{padding:8px;margin:8px}.searchContainer{margin-top:8px}yp-posts-filter{padding-right:16px}.half{width:50%}.searchBox{--paper-input-container-label:{font-size:22px;color:#555};margin-bottom:22px;margin-right:8px}@media (max-width:800px){.searchBox{--paper-input-container-label:{font-size:17px};margin-bottom:8px}.half{width:100%}.searchContainer{@apply --layout-center-center;}}.noIdeas{background-color:#FFF;max-width:200px;padding:16px;margin:16px;margin-top:32px}.noIdeasText{font-weight:700}.card{padding:0;padding-top:8px}.card[wide-padding]{padding:16px!important}#searchInput{margin-left:8px}[hidden]{display:none!important}:focus{outline:0}.largeAjax{position:absolute;bottom:32px}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query><iron-a11y-keys id="a11y" target="[[searchTarget]]" keys="enter" on-keys-pressed="_search"></iron-a11y-keys><div class="layout vertical center-center"><div class="searchContainer layout horizontal wrap" hidden$="[[group.configuration.hidePostFilterAndSearch]]"><div class="layout horizontal center-center"><yp-posts-filter on-tap="_tapOnFilter" sub-title="{{subTitle}}" class="filter" id="postsFilter" tab-name="[[statusFilter]]" on-refresh-group="_refreshGroupFromFilter" group="[[group]]" filter="{{filter}}" searching-for="{{searchingFor}}" category-id="{{categoryId}}" category-name="{{categoryName}}" posts-count="{{postsCount}}"></yp-posts-filter></div><div class="layout horizontal center-center"><paper-input id="searchInput" label$="[[t('searchFor')]]" value="{{searchingFor}}" class="searchBox"></paper-input><paper-icon-button icon="search" on-tap="_search" hidsden$="[[!showSearchIcon]]"></paper-icon-button></div></div><template is="dom-if" if="[[noPosts]]" restamp=""><div class="layout horiztonal center-center"><paper-material class="noIdeas layout horizontal center-center" elevation="2"><div class="noIdeasText">[[t('noIdeasHere')]]</div></paper-material></div></template><div class="layout horizontal center-center"><iron-list id="ironList" scroll-offset="550" items="[[posts]]" as="post" scroll-target="document" grid=""><template><div tabindex$="[[tabIndex]]" wide-padding$="[[wide]]" class="card layout vertical center-center"><yp-post-card class="card" post="[[post]]" on-mouseover="cardMouseOver" on-mouseout="cardMouseOut"></yp-post-card></div></template></iron-list></div><div class="layout horizontal center-center largeAjax"><yp-ajax id="ajax" large-spinner="" on-response="_postsResponse"></yp-ajax></div></div></template><script>Polymer({is:"yp-post-list",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypIronListBehavior],properties:{categories:{type:Array},subTitle:{type:String,notify:!0},defaultCategories:{type:Boolean,value:!1},posts:{type:Array,value:null,notify:!0},groupId:{type:Number,observer:"_groupIdChanged"},userId:{type:Number},group:{type:Object,notify:!0,observer:"_groupChanged"},filter:{type:String,value:"newest",observer:"_filterChanged"},statusFilter:{type:String,value:"open",notify:!0},categoryId:{type:String,observer:"_categoryIdChanged"},postsCount:{type:Number,notify:!0},searchTarget:{type:Object,computed:"_searchTarget(noPosts)"},categoryName:{type:String},searchingFor:{type:String,value:null,observer:"_searchingForChanged"},selectedCategoryName:{type:String},selectedTab:{type:String,observer:"_selectedTabChanged"},tabCounterId:{type:String},oldestPostAt:{type:Date},noPosts:{type:Boolean,value:!1},wideListOffset:{type:Number,value:610},listOffset:{type:String,value:"500px"},showSearchIcon:{type:Boolean,value:!1},randomSeed:{type:Number,value:null}},_tapOnFilter:function(){window.appGlobals.activity("click","filter")},_searchTarget:function(t){t||this.async(function(){return this.$$("#searchInput")})},_selectedTabChanged:function(t){this.statusFilter},_search:function(){window.appGlobals.activity("click","search"),this.searchingFor&&""!=this.searchingFor&&this._refreshGroupFromFilter()},cardMouseOver:function(t){t.currentTarget.elevation=4},cardMouseOut:function(t){t.currentTarget.elevation=1},buildPostsUrlPath:function(){return this.$.postsFilter.buildPostsUrlPath()},_searchingForChanged:function(t,e){this.set("moreToLoad",!0),t&&""!=t?this.set("showSearchIcon",!0):this.set("showSearchIcon",!1)},_filterChanged:function(t,e){this.set("moreToLoad",!0)},_categoryIdChanged:function(t,e){this.set("moreToLoad",!0)},ready:function(){},_groupIdChanged:function(t,e){},_groupChanged:function(t){this.set("posts",null),this.set("noPosts",!1),this.set("randomSeed",Math.random()),t&&(this.set("moreToLoad",!0),t.configuration&&void 0!=t.configuration.canAddNewPosts?!0===t.configuration.canAddNewPosts?this.set("filter","newest"):!1===t.configuration.canAddNewPosts&&!1===t.configuration.canVote?this.set("filter","top"):this.set("filter","random"):this.filter||this.set("filter","newest"),this._loadMoreData())},_refreshGroupFromFilter:function(){this.set("posts",null),this.set("moreToLoad",!0),this._loadMoreData()},_loadMoreData:function(){var t,e;this.moreToLoad&&this.group&&(console.info("_loadMoreData for groupId: "+this.groupId+" statusFilter: "+this.statusFilter),this.set("moreToLoad",!1),this.set("noPosts",!1),this.userId?(t=this.userId+"/posts",e="users"):(t=this.groupId,e="groups"),this.searchingFor?this.$$("#ajax").url="/api/"+e+"/"+t+"/search/"+this.searchingFor:(this.$$("#ajax").url="/api/"+e+"/"+t+"/posts/"+this.filter,this.categoryId?this.$$("#ajax").url+="/"+this.categoryId:this.$$("#ajax").url+="/null",this.$$("#ajax").url+="/"+this.statusFilter),this.$$("#ajax").url+="?offset="+(null!=this.posts?this.posts.length:0),this.randomSeed&&(this.$$("#ajax").url+="&randomSeed="+this.randomSeed),this.$$("#ajax").generateRequest())},_postsResponse:function(t,e,s){var o=e.response.posts;if(this.set("postsCount",e.response.totalPostsCount),this.fire("yp-post-count",{tabCounterId:this.tabCounterId,count:this.postsCount}),this.posts)for(var r=0;r<o.length;r++)this.push("posts",o[r]);else this.set("posts",o);0!=o.length||null!=this.posts&&0!=this.posts.length||this.set("noPosts",!0),o.length>0?this.set("noPosts",!1):this.searchingFor&&""!=this.searchingFor&&this.set("noPosts",!1),this.async(function(){var t=this.$$("#postsFilter");t&&t._updateTitle()},20),this.async(function(){this.$$("#ironList").fire("iron-resize")}),o.length>0&&o.length!=this.postsCount&&this.set("moreToLoad",!0),document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"yp-refresh-activities-scroll-threshold",data:{}}})),this._processCategories()},_processCategories:function(){if(this.categoryId&&this.group)for(var t=0;t<this.group.Categories.length;t++)this.group.Categories[t].id==this.categoryId&&(this.selectedCategoryName=this.group.Categories[t].name);else this.selectedCategoryName="categories.all"}});</script></dom-module><dom-module id="yp-group-card-large"><template><style include="iron-flex iron-flex-alignment">.groupAccess{padding-bottom:8px}.group-name{padding-bottom:4px;margin:0;font-size:24px;font-weight:700}.group-name[admin]{padding-right:16px}.groupCard{background-color:#fefefe;color:#333;height:243px;width:432px;padding:0!important;margin-top:0!important}.stats{position:absolute;bottom:0;right:8px}.edit{color:#FFF;position:absolute;top:0;left:384px;padding-right:0;margin-right:0}.description-and-stats{width:100%}.newCategory{color:var(--primary-background-color,#F2F2F2);position:absolute;top:64px;right:0}iron-image,video{width:432px;height:243px}.description{padding:0;margin:0}.groupDescription{padding-left:16px;padding-right:16px;padding-top:16px;font-size:var(--group-description-font-size,16px)}.group-name{background-color:var(--primary-color-800,#000);color:#fafafa;padding-left:16px;padding-top:16px;padding-bottom:16px;padding-right:32px!important;min-height:28px}.textBox{margin-left:32px;position:relative}@media (max-width:945px){:host{width:306px}.groupCard{margin-bottom:16px;width:306px;height:100%}.top-card{margin-top:16px!important}.edit{left:265px}iron-image,video{width:306px;height:172px!important}.imageCard{height:172px!important}.group-name{font-size:20px;min-height:24px}.groupDescription{padding-top:6px;padding-bottom:42px}.textBox{margin-left:0}}[hidden]{display:none!important}a{text-decoration:none;color:inherit}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-yp-pause-video="_pauseVideo"></lite-signal><div class="layout horizontal center-center wrap"><paper-material id="cardImage" elevation="3" animated="" class="groupCard imageCard top-card"><template is="dom-if" if="[[groupVideoURL]]" restamp=""><video id="videoPlayer" controls="" class="logo" src="[[groupVideoURL]]"></video></template><template is="dom-if" if="[[!groupVideoURL]]"><iron-image class="logo" sizing="cover" preload="" src="[[groupLogoImagePath]]"></iron-image></template></paper-material><paper-material id="card" elevation="3" animated-shadow="" class="groupCard textBox"><div class="layout vertical"><div class="layout horizontal wrap"><div class="layout vertical description-and-stats"><div class="description"><div class="group-name" admin$="[[hasGroupAccess]]"><yp-magic-text id="groupName" text-type="groupName" content-language="[[group.language]]" disable-translation="[[group.configuration.disableNameAutoTranslation]]" text-only="" content="[[groupName]]" content-id="[[group.id]]"></yp-magic-text></div><div hidden="" class="groupAccess">[[groupAccessText]]</div><yp-magic-text id="objectives" class="groupDescription" text-type="groupContent" content-language="[[group.language]]" content="[[group.objectives]]" content-id="[[group.id]]"></yp-magic-text></div></div><paper-menu-button class="edit" horizontal-align="[[editMenuAlign]]" hidden$="[[!showMenuItem]]"><paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content" on-iron-select="_menuSelection"><paper-item hidden$="[[!hasGroupAccess]]" id="editMenuItem">[[t('group.edit')]]</paper-item><paper-item hidden$="[[!hasGroupAccess]]" id="newCategoryMenuItem">[[t('category.new')]]</paper-item><paper-item hidden$="[[!hasGroupAccess]]" id="usersMenuItem">[[t('group.users')]]</paper-item><paper-item hidden$="[[!hasGroupAccess]]" id="adminsMenuItem">[[t('group.admins')]]</paper-item><paper-item hidden$="[[!hasGroupAccess]]" id="pagesMenuItem">[[t('pages.managePages')]]</paper-item><a hidden$="[[!hasGroupAccess]]" target="_blank" href="/api/groups/[[group.id]]/export_group"><paper-item id="exportMenuItem">[[t('exportGroup')]]</paper-item></a><paper-item hidden$="[[!hasGroupAccess]]" id="deleteMenuItem">[[t('group.delete')]]</paper-item><paper-item hidden$="[[!hasGroupAccess]]" id="anonymizeMenuItem">[[t('anonymizeGroupContent')]]</paper-item><paper-item hidden$="[[!hasGroupAccess]]" id="deleteContentMenuItem">[[t('deleteGroupContent')]]</paper-item><paper-item id="addPostMenuItem">[[t('post.new')]]</paper-item></paper-listbox></paper-menu-button></div><yp-group-stats class="stats" group="[[group]]"></yp-group-stats></div><iron-media-query query="(max-width: 800px)" query-matches="{{narrowScreen}}"></iron-media-query><lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal></paper-material></div></template><script>Polymer({is:"yp-group-card-large",behaviors:[Polymer.ypLanguageBehavior,Polymer.GroupBehaviors,Polymer.LargeCardBehaviors,Polymer.AccessHelpers,Polymer.ypGotAdminRightsBehavior,Polymer.ypGotoBehavior,Polymer.ypTruncateBehavior,Polymer.ypImageFormatsBehavior],properties:{group:{type:Object,observer:"_groupChanged"},hasGroupAccess:{type:Boolean,value:!1,computed:"_hasGroupAccess(group, gotAdminRights)"},groupAccessText:{type:String,computed:"_groupAccessText(group, language)"},showMenuItem:{type:Boolean,value:!1,computed:"_showMenuItem(hasGroupAccess, group)"},groupVideoURL:{type:String,computed:"_groupVideoURL(group)"}},_pauseVideo:function(){var e=this.$$("#videoPlayer");e&&e.pause()},_groupVideoURL:function(e){return e&&e.configuration.useVideoCover&&e.GroupLogoVideos&&e.GroupLogoVideos.length>0&&e.GroupLogoVideos[0].viewable?e.GroupLogoVideos[0].formats[0]:null},_showMenuItem:function(e,o){return e||o&&o.configuration&&!0===o.configuration.canAddNewPosts},_hasGroupAccess:function(e,o){return!(!e||!o)&&null!=this.checkGroupAccess(e)},resetGroup:function(){this.set("group",null)},_groupChanged:function(e){e&&e.objectives&&e.objectives.length>220?this.$$("#objectives").style.fontSize="15px":this.$$("#objectives").style.fontSize="16px"},_groupAccessText:function(e,o){if(!e||!o)return"";switch(e.access){case 0:return this.t("group.public");case 1:return this.t("group.closed");case 2:return this.t("group.secret")}},_menuSelection:function(e,o){"editMenuItem"===o.item.id?this._openEdit():"newCategoryMenuItem"===o.item.id?this._openCategoryEdit():"deleteMenuItem"===o.item.id?this._openDelete():"usersMenuItem"===o.item.id?this._openUsersDialog():"adminsMenuItem"===o.item.id?this._openAdminsDialog():"pagesMenuItem"===o.item.id?this._openPagesDialog():"addPostMenuItem"===o.item.id?this.fire("yp-post-new"):"deleteContentMenuItem"===o.item.id?this._openDeleteContent():"anonymizeMenuItem"===o.item.id&&this._openAnonymizeContent(),this.$$("paper-listbox").select(null)},_openPagesDialog:function(){window.appGlobals.activity("open","group.pagesAdmin"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("pagesGrid",function(e){e.setup(this.group.id,null,null,!1),e.open()}.bind(this))},_openUsersDialog:function(){window.appGlobals.activity("open","group.users"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(this.group.id,null,null,!1),e.open(this.group.name)}.bind(this))},_openAdminsDialog:function(){window.appGlobals.activity("open","group.admins"),Polymer.dom(document).querySelector("yp-app").getUsersGridAsync(function(e){e.setup(this.group.id,null,null,!0),e.open(this.group.name)}.bind(this))},_openEdit:function(){window.appGlobals.activity("open","group.edit"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("groupEdit",function(e){this._refreshGroup(this.group.id,function(o){e.setup(o,!1,this._refresh.bind(this)),e.open("edit",{groupId:o.id})}.bind(this))}.bind(this))},_refreshGroup:function(e,o){var t=document.createElement("iron-ajax");t.url="/api/groups/"+e,t.handleAs="json",t.contentType="application/json",t.body={},t.addEventListener("response",function(e,t){o(e.detail.response.group)}.bind(this)),t.addEventListener("error",function(e,o){console.error("Couldn't refresh grop")}.bind(this)),t.generateRequest()},_openDelete:function(){window.appGlobals.activity("open","group.delete"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/groups/"+this.group.id,this.t("groupDeleteConfirmation"),this._onDeleted.bind(this)),e.open({finalDeleteWarning:!0})}.bind(this))},_openDeleteContent:function(){window.appGlobals.activity("open","group.deleteContent"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/groups/"+this.group.id+"/delete_content",this.t("groupDeleteContentConfirmation")),e.open({finalDeleteWarning:!0})}.bind(this))},_openAnonymizeContent:function(){window.appGlobals.activity("open","group.anonymize"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/groups/"+this.group.id+"/anonymize_content",this.t("groupAnonymizeConfirmation"),null,this.t("anonymize")),e.open({finalDeleteWarning:!0})}.bind(this))},_openCategoryEdit:function(){window.appGlobals.activity("open","category.new"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("categoryEdit",function(e){e.setup(this.group,!0,this._refreshCategory.bind(this)),e.open("new",{groupId:this.group.id})}.bind(this))},_refreshCategory:function(e){this.fire("update-group")},_onDeleted:function(){this.dispatchEvent(new CustomEvent("yp-refresh-community",{bubbles:!0,composed:!0})),this.redirectTo("/community/"+this.group.community_id)},_newCategory:function(){this.$$("#newCategory").open("new",{groupId:this.group.id})},_refresh:function(e){e&&this.set("group",e),this.fire("update-group")}});</script></dom-module></div><dom-module id="yp-group"><template><style include="iron-flex iron-flex-alignment">.objectives{padding-bottom:40px;max-width:432px}.description{padding:12px}yp-ajax{background-color:var(--primary-background-color)}.counterInfo{font-size:11px}.topContainer{margin-top:16px}.createFab{position:fixed;bottom:24px;right:28px;background-color:var(--accent-color);color:#FFF;--paper-fab-iron-icon:{color:var(--icon-general-color,#FFF);height:40px;width:40px};}.createFab[wide-layout]{width:72px;height:72px;--paper-fab-iron-icon:{color:var(--icon-general-color,#FFF);width:72px;height:72px};}.topArea{background-color:var(--primary-background-color);background-image:var(--top-area-background-image,none);height:300px}.tabs{width:1100px;padding-top:8px;padding-bottom:8px}.tabs .tab{width:250px}.largeAddButton{margin-bottom:4px;margin-top:4px}@media (max-width:1024px){.tabs{max-width:920px}.tabs .tab{width:200px}}@media (max-width:900px){.tabs{max-width:550px;width:550px;font-size:14px;word-wrap:break-word!important}.tabs[has-non-open-posts]{font-size:10px}.counterInfo[has-non-open-posts]{font-size:9px}.tabs .tab{width:120px;word-wrap:break-word!important}.topArea{height:auto}.largeAddButton[is-apple]{margin-top:32px}.largeAddButton[is-ipad]{margin-top:48px}}@media (max-width:380px){.tabs{max-width:360px;font-size:12px;width:360px}paper-tab{width:170px}}@media (max-width:320px){.tabs{max-width:320px;font-size:12px;width:320px}paper-tab{width:160px}}.tabSubTitle{font-size:13px}.minHeightSection{min-height:450px}.tabContainer[hide]{display:none}[hidden]{display:none!important}</style><div id="topContainer"><div id="topArea" class="large-card-wrapper layout horizontal center-center topArea" hidden$="[[group.configuration.hideGroupHeader]]"><yp-group-card-large id="groupCard" class="largeCard" group="[[group]]" on-update-group="_refreshAjax"></yp-group-card-large></div><div class="largeAddButton layout horizontal center-center" is-apple$="[[isOldiOs]]" is-ipad$="[[isIpad]]" hidden$="[[group.configuration.hideNewPost]]"><yp-post-card-add disabled="[[disableNewPosts]]" on-new-post="_newPost" elevation="2"></yp-post-card-add></div><div class="layout horizontal center-center tabContainer" hide$="[[group.configuration.hideAllTabs]]"><paper-tabs scrollable$="[[!wideWidth]]" id="paperTabs" has-non-open-posts$="[[hasNonOpenPosts]]" class="tabs" selected="{{selectedTab}}" attr-for-selected="name" focused=""><paper-tab id="tab1" name="open"><div class="layout vertical center-center tabCounterContainer"><div hidden$="[[isTabOpen]]">[[t('posts.open')]]</div><div hidden$="[[!isTabOpen]]" class="tabSubTitsle">[[tabOpenSubTitle]]</div><div class="counterInfo" has-non-open-posts$="[[hasNonOpenPosts]]" id="tabCountOpen"></div></div></paper-tab><template is="dom-if" if="[[hasNonOpenPosts]]"><paper-tab name="in_progress"><div class="layout vertical center-center tabCounterContainer"><div>[[t('posts.inProgress')]]</div><div hidden$="[[!isTabInProgress]]" class="tabSubTitle">[[tabInProgressSubTitle]]</div><div hidden$="[[isTabInProgress]]" has-non-open-posts$="[[hasNonOpenPosts]]" class="counterInfo" id="tabCountInProgress"></div></div></paper-tab><paper-tab name="successful"><div class="layout vertical center-center tabCounterContainer"><div>[[t('posts.successful')]]</div><div hidden$="[[!isTabSuccessful]]" class="tabSubTitle">[[tabSuccessfulSubTitle]]</div><div hidden$="[[isTabSuccessful]]" has-non-open-posts$="[[hasNonOpenPosts]]" class="counterInfo" id="tabCountSuccessful"></div></div></paper-tab><paper-tab name="failed"><div class="layout vertical center-center tabCounterContainer"><div>[[t('posts.failed')]]</div><div hidden$="[[!isTabFailed]]" class="tabSubTitle">[[tabFailedSubTitle]]</div><div hidden$="[[isTabFailed]]" has-non-open-posts$="[[hasNonOpenPosts]]" class="counterInfo" id="tabCountFailed"></div></div></paper-tab></template><paper-tab name="news">[[t('news')]]</paper-tab><paper-tab name="map" hidden$="[[locationHidden]]">[[t('posts.map')]]</paper-tab></paper-tabs></div><iron-pages id="tabPages" class="tabPages" selected="{{selectedTab}}" attr-for-selected="name" entry-animation="fade-in-animation" exit-animation="fade-out-animation"><section name="open"><div class="layout horizontal center-center"><yp-post-list id="openPostList" sub-title="{{tabOpenSubTitle}}" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="open" tab-counter-id="tabCountOpen" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list></div></section><section name="news" class="minHeightSection"><template is="dom-if" if="[[newsTabSelected]]"><ac-activities id="groupActivities" disable-new-posts="[[disableNewPosts]]" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" group-id="[[group.id]]"></ac-activities></template></section><template is="dom-if" if="[[hasNonOpenPosts]]"><section name="in_progress"><div class="layout horizontal center-center"><yp-post-list id="inProgressPostList" sub-title="{{tabInProgressSubTitle}}" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="in_progress" tab-counter-id="tabCountInProgress" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list></div></section><section name="successful"><div class="layout horizontal center-center"><yp-post-list id="successfulPostList" sub-title="{{tabSuccessfulSubTitle}}" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="successful" tab-counter-id="tabCountSuccessful" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list></div></section><section name="failed"><div class="layout horizontal center-center"><yp-post-list id="failedPostList" sub-title="{{tabFailedSubTitle}}" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="failed" tab-counter-id="tabCountFailed" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list></div></section></template><section name="map" hidden$="[[locationHidden]]" class="minHeightSection"><template is="dom-if" if="[[mapActive]]" restamp=""><yp-post-map group-id="[[group.id]]"></yp-post-map></template></section></iron-pages></div><template is="dom-if" if="[[!disableNewPosts]]" restamp=""><div class="create-fab-wrapper layout horizontal end-justified createFabContainer" hidden$="[[disableNewPosts]]"><paper-fab class="createFab" icon="[[createFabIcon]]" elevation="5" wide-layout$="{{wideWidth}}" title="[[createFabTitle]]" on-tap="_newPost"></paper-fab></div></template><iron-scroll-threshold id="scrollTheshold" lower-threshold="550" on-lower-threshold="_loadMoreData" scroll-target="document"></iron-scroll-threshold><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-yp-refresh-group-posts="_refreshGroupPosts"></lite-signal><lite-signal on-lite-signal-yp-refresh-activities-scroll-threshold="_clearScrollThreshold"></lite-signal><iron-media-query query="(min-width: 1024px)" query-matches="{{wideWidth}}"></iron-media-query><app-route route="{{idRoute}}" pattern="/:id" data="{{idRouteData}}" tail="{{tabRoute}}"></app-route><app-route route="{{tabRoute}}" pattern="/:tabName" data="{{tabRouteData}}" tail="{{listRoute}}"></app-route><div class="layout horizontal center-center"><yp-ajax large-spinner="" id="ajax" on-response="_groupsResponse"></yp-ajax><yp-ajax id="pagesAjax" on-response="_pagesResponse"></yp-ajax></div></template><script>Polymer({is:"yp-group",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypThemeBehavior,Polymer.YpNewsTabSelected,Polymer.ypDetectOldiOs,Polymer.ypGotoBehavior,Polymer.ypImageFormatsBehavior,Polymer.ypNumberFormatBehavior],listeners:{"yp-post-count":"_updateTabPostCount","yp-post-new":"_newPost"},properties:{idRoute:Object,tabRoute:Object,idRouteData:Object,tabRouteData:Object,listRoute:Object,createFabIcon:{type:String,value:"lightbulb-outline"},groupId:{type:Number,observer:"_groupIdChanged"},group:{type:Object,notify:!0,value:null},searchingFor:{type:String,value:null},selectedTab:{type:String,value:"open",observer:"_selectedTabChanged"},hasNonOpenPosts:{type:Boolean,value:!1,observer:"_refreshTabsAndPages"},mapActive:{type:Boolean,value:!1},lastValidGroupId:{type:String},disableNewPosts:{type:Boolean,value:!1},locationHidden:{type:Boolean,value:!1},haveGotTabCountInfoCount:{type:Number,value:0},tabCounters:{type:Object,value:{}},tabOpenSubTitle:String,tabInProgressSubTitle:String,tabSuccessfulSubTitle:String,tabFailedSubTitle:String,isTabOpen:{type:Boolean,computed:"_isTabOpen(selectedTab)"},isTabInProgress:{type:Boolean,computed:"_isTabInProgress(selectedTab)"},isTabSuccessful:{type:Boolean,computed:"_isTabSuccessful(selectedTab)"},isTabFailed:{type:Boolean,computed:"_isTabFailed(selectedTab)"},isOldiOs:{type:Boolean,computed:"_isOldiOs(groupId)"},isIpad:{type:Boolean,computed:"_isIpad(groupId)"}},observers:["_routeIdChanged(idRouteData.id)","_routeTabChanged(tabRouteData.tabName)"],_isTabOpen:function(e){return"open"===e},_isTabInProgress:function(e){return"in_progress"===e},_isTabFailed:function(e){return"failed"===e},_isTabSuccessful:function(e){return"successful"===e},_clearScrollThreshold:function(){this.$$("#scrollTheshold").clearTriggers(),console.info("Clearing scrolling triggers for group")},_loadDataOnTab:function(e){var t=this.$$("#"+e);t?t._loadMoreData():console.error("Cant find tab "+e)},_isIpad:function(){return/iPad/.test(navigator.userAgent)&&!window.MSStream},_loadMoreData:function(){"open"==this.selectedTab?this._loadDataOnTab("openPostList"):"in_progress"==this.selectedTab?this._loadDataOnTab("inProgressPostList"):"successful"==this.selectedTab?this._loadDataOnTab("successfulPostList"):"failed"==this.selectedTab&&this._loadDataOnTab("failedPostList")},_refreshGroupPosts:function(){this.$$("#openPostList")._refreshGroupFromFilter()},_routeIdChanged:function(e){e&&this.set("groupId",e)},_routeTabChanged:function(e){e&&this.set("selectedTab",e)},_selectedTabChanged:function(e){"config"==e?this.async(function(){var e=this.listRoute.path,t=this.idRoute.path.split("/")[1],o=e.substring(1,e.length);t&&o&&""!=o&&window.appGlobals.setupGroupConfigOverride(t,o),this.set("selectedTab","open")}):(this.group&&this.redirectTo("/group/"+this.group.id+"/"+e),"map"==e?this.set("mapActive",!0):this.set("mapActive",!1),e&&window.appGlobals&&window.appGlobals.activity("open","group_tab_"+e),this.async(function(){var e=this.$$("#groupActivities");e&&e.fireResize()},300))},_refreshTabsAndPages:function(){this.async(function(){var e=this.$$("#tabPages");e&&e.forceSynchronousItemUpdate();var t=this.$$("#paperTabs");t&&(t.forceSynchronousItemUpdate(),t.notifyResize())},10)},_updateTabPostCount:function(e,t){var o=this.$$("#"+t.tabCounterId);o&&(o.innerHTML=this.formatNumber(t.count),this.tabCounters[t.tabCounterId]=t.count),this.haveGotTabCountInfoCount+=1,this.hasNonOpenPosts&&4==this.haveGotTabCountInfoCount&&(this.tabCounters.tabCountOpen&&this.tabCounters.tabCountOpen>0?this.set("selectedTab","open"):this.tabCounters.tabCountInProgress&&this.tabCounters.tabCountInProgress>0?this.set("selectedTab","in_progress"):this.tabCounters.tabCountSuccessful&&this.tabCounters.tabCountSuccessful>0?this.set("selectedTab","successful"):this.tabCounters.tabCountFailed&&this.tabCounters.tabCountFailed>0&&this.set("selectedTab","failed"))},_searchingForChanged:function(e,t){},_filterChanged:function(e,t){},_categoryIdChanged:function(e,t){},_openEdit:function(){this.$$("#groupEdit").open("edit",{groupId:this.group.id})},_refreshAjax:function(){this.$.ajax.generateRequest(),this.$$("#groupActivities")&&this.$$("#groupActivities").loadNewData()},ready:function(){},_groupIdChanged:function(e,t){e&&e!=this.lastValidGroupId&&(this.set("lastValidGroupId",e),this.set("group",null),this.$.groupCard.resetGroup(),this.$.tabCountOpen.innerHTML="",this.hasNonOpenPosts&&(this.$$("#tabCountInProgress").innerHTML="",this.$$("#tabCountSuccessful").innerHTML="",this.$$("#tabCountFailed").innerHTML=""),this.set("selectedTab","open"),this.set("hasNonOpenPosts",!1),this.set("haveGotTabCountInfoCount",0),this.set("tabCounters",{}),this._getGroup())},_getGroup:function(){this.$.ajax.url="/api/groups/"+this.groupId,this.$.ajax.retryMethodAfter401Login=this._getGroup.bind(this),this.$.ajax.generateRequest()},_pagesResponse:function(e,t){this.fire("yp-set-pages",t.response)},_groupsResponse:function(e,t,o){this.set("group",t.response.group),this.set("group.configuration",window.appGlobals.overrideGroupConfigIfNeeded(this.group.id,this.group.configuration)),this.refresh(),void 0!=this.group.configuration.canAddNewPosts?!0===this.group.configuration.canAddNewPosts?this.set("disableNewPosts",!1):this.set("disableNewPosts",!0):this.set("disableNewPosts",!1),this.set("hasNonOpenPosts",t.response.hasNonOpenPosts),"edit"==this.selectedTab&&(this.set("tabName","open"),this.$$("#groupCard")._openEdit())},setupTopHeaderImage:function(e){var t;this.wideWidth&&(t=e?"url("+this.getImageFormatUrl(e,0)+")":"none",this.updateStyles({"--top-area-background-image":t}))},refresh:function(){this.group&&(this.fire("yp-set-home-link",{type:"group",id:this.group.id,name:this.group.name}),null!=this.group.configuration.defaultLocale&&window.appGlobals.changeLocaleIfNeeded(this.group.configuration.defaultLocale),window.appGlobals.setCommunityAnalyticsTracker(this.group.Community.google_analytics_code),this.group.Community.configuration&&window.appGlobals.setCommunityPixelTracker(this.group.Community.configuration.facebookPixelId),null!=this.group.theme_id?this.setTheme(this.group.theme_id):null!=this.group.Community.theme_id?this.setTheme(this.group.Community.theme_id):null!=this.group.Community.Domain.theme_id&&this.setTheme(this.group.Community.Domain.theme_id),this.group.configuration.locationHidden&&1==this.group.configuration.locationHidden?this.set("locationHidden",!0):this.set("locationHidden",!1),this._refreshTabsAndPages(),this.group.GroupHeaderImages&&this.group.GroupHeaderImages.length>0?this.setupTopHeaderImage(this.group.GroupHeaderImages):this.setupTopHeaderImage(null),this.fire("change-header",{headerTitle:this.group.configuration.fixedReturnUrlName?this.group.configuration.fixedReturnUrlName:this.group.Community.name,headerDescription:this.group.Community.description,headerIcon:"social:group",documentTitle:this.group.name,enableSearch:!0,hideHelpIcon:!!this.group.configuration.hideHelpIcon||null,useHardBack:!!this.group.configuration.fixedReturnUrl,backPath:this.group.configuration.fixedReturnUrl?this.group.configuration.fixedReturnUrl:"/community/"+this.group.community_id}),this.$.pagesAjax.url="/api/groups/"+this.group.id+"/pages",this.$.pagesAjax.generateRequest(),window.appGlobals.setAnonymousGroupStatus(this.group),this.group.configuration&&!0===this.group.configuration.disableFacebookLoginForGroup?window.appGlobals.disableFacebookLoginForGroup=!0:window.appGlobals.disableFacebookLoginForGroup=!1,this.group.configuration&&this.group.configuration.externalGoalTriggerUrl?window.appGlobals.externalGoalTriggerUrl=this.group.configuration.externalGoalTriggerUrl:window.appGlobals.externalGoalTriggerUrl=null,this.group.Community&&this.group.Community.configuration&&this.group.Community.configuration.signupTermsPageId&&-1!=this.group.Community.configuration.signupTermsPageId?window.appGlobals.signupTermsPageId=this.group.Community.configuration.signupTermsPageId:window.appGlobals.signupTermsPageId=null,this.group.configuration&&this.group.configuration.forceSecureSamlLogin?window.appGlobals.currentGroupForceSaml=!0:window.appGlobals.currentGroupForceSaml=!1)},_newPost:function(){window.appGlobals.activity("open","newPost"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("postEdit",function(e){e.setup(null,!0,null),e.open("new",{groupId:this.groupId,group:this.group})}.bind(this))}});</script></dom-module>