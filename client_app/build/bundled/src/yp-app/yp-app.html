<link rel="import" href="../../bower_components/polymer/polymer.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-pages/iron-pages.html?v=8.0.0-4"><link rel="import" href="../../bower_components/lite-signal/lite-signal.html?v=8.0.0-4"><link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-badge/paper-badge.html?v=8.0.0-4"><link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-layout/app-header/app-header.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-layout/app-scroll-effects/effects/waterfall.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-route/app-location.html?v=8.0.0-4"><link rel="import" href="../../bower_components/app-route/app-route.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-lodash-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-moment-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-language-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-app-globals/yp-app-globals.html?v=8.0.0-4"><link rel="import" href="../yp-app-globals/yp-app-user.html?v=8.0.0-4"><link rel="import" href="../yp-theme/yp-theme-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-goto-behavior.html?v=8.0.0-4"><link rel="import" href="../yp-behaviors/yp-translated-pages-behavior.html?v=8.0.0-4"><link rel="import" href="../ac-notifications/ac-notification-list.html?v=8.0.0-4"><link rel="import" href="yp-app-nav-drawer.html?v=8.0.0-4"><link rel="import" href="../yp-dialog-container/yp-dialog-container.html?v=8.0.0-4"><link rel="import" href="../yp-user/yp-user-image.html?v=8.0.0-4"><link rel="import" href="../yp-app-globals/yp-sw-update-toast.html?v=8.0.0-4"><dom-module id="yp-app"><template><style include="iron-flex iron-flex-alignment">:host{--main-stats-color-on-white:#878787;--paper-dialog-button-color:var(--accent-color);--paper-tabs-selection-bar-color:var(--accent-color);--paper-input-container-focus-color:var(--accent-color);--paper-dropdown-menu:{background-color:#FFF};--icon-general-color:'#fff';--master-point-up-color:rgba(0,127,0,0.62);--master-point-down-color:rgba(127,0,0,0.62)}:host{--paper-dropdown-menu:{background-color:#FFF};--light-primary-color:#FFCC80;--text-primary-color:#fff;--dark-primary-color:#F57C00;--primary-text-color:#212121;--secondary-text-color:#727272;--disabled-text-color:#bdbdbd;--divider-color:#FF5722;--paper-tabs:{font-size:18px;text-transform:uppercase};--paper-fab-mini:{background:var(--primary-background-color);color:#555!important};--paper-tabs-selection-bar:{border-bottom:4px solid!important;border-bottom-color:var(--accent-color,#000)!important};--drawer-menu-color:#ffffff;--drawer-border-color:1px solid #ccc;--paper-menu-background-color:var(--primary-background-color);--menu-link-color:#111111}:host{background-color:var(--primary-background-color)}app-header{color:#fff;background-color:var(--primary-background-color)}app-toolbar{color:#FFF}iron-pages{background-color:var(--primary-background-color)}[condensed-title]{font-size:16px}[title]{padding-top:8px;padding-left:8px;padding-bottom:8px}.backIcon{width:32px!important;height:32px!important;margin-right:12px;margin-left:12px;padding:0;margin-top:4px}.backIcon[hide]{display:none}.closePostIcon{width:52px;height:52px}.main-header{border-bottom:1px solid var(--primary-color-800);background-color:var(--primary-color-800);color:#333;height:64px}.dropdown-content{width:200px}#paperToggleNavMenu{min-width:40px}#translationButton{color:#FFF;background-color:var(--accent-color);margin-left:4px;padding:6px;min-width:0!important}.stopIcon{margin-left:6px}@media (max-width:480px){.stopIcon{display:none}#translationButton{width:40px!important;max-width:40px!important}div[title]{font-size:17px;white-space:normal!important;padding-left:0}.backIcon{min-width:28px!important;min-height:28px!important}.closePostIcon{width:48px;height:48px}.loginButton{font-size:15px;padding:4px}paper-menu-button{padding:0}paper-button{padding:0;margin:0}#translationIcon{width:30px;height:30px;padding:6px}}@media (max-width:340px){div[title]{font-size:17px;white-space:normal!important;padding-left:0}.backIcon{min-width:26px!important;min-height:26px!important}.loginButton{font-size:12px;padding:0}}.userImageNotificationContainer{cursor:pointer;margin-right:8px;display:inline-block}.activeBadge{--paper-badge-background:var(--accent-color)}.helpButton[hide]{display:none}.navContainer[hide]{display:none}[hidden]{display:none!important}#headerTitle{padding-right:0!important}</style><iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query><yp-app-globals id="appGlobals" setup-defaults="" on-change-header="onChangeHeader"></yp-app-globals><app-drawer-layout drawer-width="360px" responsive-width="16000px" fullbleed=""><app-drawer id="drawer" slot="drawer" align="end" position="right" opened="{{userDrawerOpened}}" swipe-open=""><div style="height:100%;overflow:auto"><ac-notification-list id="acNotificationsList" user="[[user]]" opened="[[userDrawerOpened]]" route="[[route]]"></ac-notification-list></div></app-drawer><app-drawer id="navDrawer" slot="drawer" align="start" position="left" swipe-open="" opened="{{navDrawOpened}}"><div style="height:100%;overflow:auto"><yp-app-nav-drawer id="ypNavDrawer" home-link="[[homeLink]]" on-yp-toggle-nav-drawer="_toggleNavDrawer" user="[[user]]" route="[[route]]"></yp-app-nav-drawer></div></app-drawer><app-header-layout id="mainArea" fullbleed=""><app-header slot="header" id="appHeader" effects="waterfall" reveals="" class="main-header"><app-toolbar><div hide$="[[closePostHeader]]" class="layout horizontal navContainer"><paper-icon-button id="paperToggleNavMenu" icon="menu" on-tap="_toggleNavDrawer"></paper-icon-button><div class="layout horizontal" style="height:100%;vertical-align:center"><div id="headerTitle" title="" class="layout vertical">[[headerTitle]]</div><paper-icon-button icon="arrow-upward" on-tap="goBack" class="backIcon" hide$="[[!showBack]]"></paper-icon-button></div></div><template is="dom-if" if="[[closePostHeader]]"><paper-icon-button id="closePostButton" class="closePostIcon" icon="arrow-back" on-tap="_closePost"></paper-icon-button></template><div hidden$="[[!autoTranslate]]" class="layout horizontal"><paper-button raised="" id="translationButton" on-tap="_stopTranslation" title="{{t('stopAutoTranslate')}}"><iron-icon icon="translate"></iron-icon><iron-icon class="stopIcon" icon="do-not-disturb"></iron-icon></paper-button></div><span class="flex"></span><paper-menu-button horizontal-align="right" hide$="[[hideHelpIcon]]" class="helpButton"><paper-icon-button icon="help-outline" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content"><template is="dom-repeat" items="[[translatedPages]]" as="page"><paper-item data-args$="[[index]]" on-tap="_openPageFromMenu">[[_getLocalizePageTitle(page)]]</paper-item></template></paper-listbox></paper-menu-button><template is="dom-if" if="[[user]]"><div class="userImageNotificationContainer layout horizontal" on-tap="_toggleUserDrawer"><yp-user-image id="userImage" small="" user="[[user]]"></yp-user-image><paper-badge class="activeBadge" label="[[numberOfUnViewedNotifications]]" hidden$="[[!numberOfUnViewedNotifications]]"></paper-badge></div></template><template is="dom-if" if="[[!user]]"><paper-button class="loginButton" on-tap="_login">[[t('user.login')]]</paper-button></template></app-toolbar></app-header><iron-pages selected="{{page}}" style="height:auto" attr-for-selected="name" fullbleed=""><yp-domain id="domainPage" name="domain" id-route$="[[domainSubRoute]]" on-change-header="onChangeHeader"></yp-domain><yp-community id="communityPage" name="community" id-route$="[[communitySubRoute]]" on-change-header="onChangeHeader"></yp-community><yp-group id="groupPage" name="group" id-route$="[[groupSubRoute]]" on-change-header="onChangeHeader"></yp-group><yp-post id="postPage" name="post" id-route$="[[postSubRoute]]" on-change-header="onChangeHeader"></yp-post><yp-user id="userPage" name="user" id-route$="[[userSubRoute]]" on-change-header="onChangeHeader"></yp-user><yp-view-404 name="view-404"></yp-view-404></iron-pages></app-header-layout></app-drawer-layout><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-yp-auto-translate="_autoTranslateEvent"></lite-signal><app-location route="{{route}}"></app-location><app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subRoute}}"></app-route><yp-dialog-container id="dialogContainer"></yp-dialog-container><yp-app-user id="appUser" on-user-changed="onUserChanged"></yp-app-user><yp-sw-update-toast button-label="[[t('reload')]]" message="[[t('newVersionAvailable')]]"></yp-sw-update-toast></template><script>Polymer({is:"yp-app",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypThemeBehavior,Polymer.ypGotoBehavior,Polymer.ypTranslatedPagesBehavior],properties:{domainSubRoute:Object,communitySubRoute:Object,groupSubRoute:Object,postSubRoute:Object,userSubRoute:Object,userDrawerOpened:Boolean,navDrawOpened:Boolean,homeLink:{type:Object},page:{type:String,reflectToAttribute:!0,observer:"_pageChanged"},route:{type:Object,observer:"_routeChanged"},routeData:{type:Object,observer:"_routePageChanged",value:null},subRoute:Object,appTitle:{type:String,value:"Your Priorities"},user:{type:Object,value:null},previousSearches:{type:Array,value:[]},showSearch:{type:Boolean,value:!1},showBack:{type:Boolean,value:!1},backPath:{type:String},storedBackPath:String,storedLastDocumentTitle:String,headerTitle:{type:String},headerDescription:{type:String},params:{type:Object},narrow:{type:Boolean},keepOpenForPost:{type:String,value:null},closePostHeader:{type:Boolean,computed:"_closePostHeader(page, keepOpenForPost)",value:null},numberOfUnViewedNotifications:{type:String,value:""},useHardBack:{type:Boolean,value:!1},hideHelpIcon:{type:Boolean,value:!1},wide:Boolean,_scrollPositionMap:{type:Object,value:function(){return{}}},autoTranslate:{type:Boolean,value:!1},languageName:String},listeners:{"yp-set-pages":"_setPages","yp-set-home-link":"_setHomeLink","yp-redirect-to":"_redirectTo","yp-set-number-of-un-viewed-notifications":"_setNumberOfUnViewedNotifications","yp-close-right-drawer":"_closeRightDrawer","yp-refresh-group":"_refreshGroup","yp-refresh-community":"_refreshCommunity","yp-refresh-domain":"_refreshDomain","yp-language-name":"_setLanguageName","yp-dialog-closed":"_dialogClosed","yp-open-page":"_openPageFromEvent","yp-open-login":"_login"},_openPageFromEvent:function(e,t){t.pageId&&this.openPageFromId(t.pageId)},_stopTranslation:function(){document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"yp-auto-translate",data:!1}})),window.autoTranslate=!1,Polymer.dom(document).querySelector("yp-app").getDialogAsync("masterToast",function(e){e.text=this.t("autoTranslationStopped"),e.show()}.bind(this))},_setLanguageName:function(e,t){this.set("languageName",t)},_autoTranslateEvent:function(e,t){this.set("autoTranslate",t)},_refreshGroup:function(){this._refreshByName("#groupPage")},_refreshCommunity:function(){this._refreshByName("#communityPage")},_refreshDomain:function(){this._refreshByName("#domainPage")},_refreshByName:function(e){var t=this.$$(e);t&&t._refreshAjax()},_closeRightDrawer:function(){this.async(function(){this.$$("#drawer").close()},100)},_setNumberOfUnViewedNotifications:function(e,t){t.count?t.count<10?this.set("numberOfUnViewedNotifications",t.count):this.set("numberOfUnViewedNotifications","9+"):this.set("numberOfUnViewedNotifications","")},_redirectTo:function(e,t){t.path&&this.set("route.path",t.path)},_routeChanged:function(e){window.location.href.indexOf("/#!/")>-1&&(window.location=window.location.href.replace("/#!/","/")),this.async(function(){e.path.indexOf("domain")>-1?(this.set("domainSubRoute",this.subRoute),this.$$("#domainPage")&&void 0!==this.$$("#domainPage").refresh&&this.$$("#domainPage").refresh()):e.path.indexOf("community")>-1?(this.set("communitySubRoute",this.subRoute),this.$$("#communityPage")&&void 0!==this.$$("#communityPage").refresh&&this.$$("#communityPage").refresh()):e.path.indexOf("group")>-1?(this.set("groupSubRoute",this.subRoute),this.$$("#groupPage")&&void 0!==this.$$("#groupPage").refresh&&this.$$("#groupPage").refresh()):e.path.indexOf("post")>-1?(this.set("postSubRoute",this.subRoute),this.$$("#postPage")&&void 0!==this.$$("#postPage").refresh&&this.$$("#postPage").refresh()):e.path.indexOf("user")>-1&&(this.set("userSubRoute",this.subRoute),this.$$("#userPage")&&void 0!==this.$$("#userPage").refresh&&this.$$("#userPage").refresh())})},_routePageChanged:function(e,t){if(e){var o=this.route.path.split("/");if(this.route.path.indexOf("/user/reset_password")>-1||this.route.path.indexOf("/user/open_notification_settings")>-1||this.route.path.indexOf("/user/accept/invite")>-1||this.route.path.indexOf("/user/info_page")>-1)this.route.path.indexOf("/user/reset_password")>-1?this.openResetPasswordDialog(o[o.length-1]):e&&"user"===e.page&&this.route.path.indexOf("/user/accept/invite")>-1?this.openAcceptInvitationDialog(o[o.length-1]):this.route.path.indexOf("/user/open_notification_settings")>-1?this.openUserNotificationsDialog():this.route.path.indexOf("/user/info_page")>-1&&(this.openUserInfoPage(o[o.length-1]),window.history.pushState({},null,"/"),window.dispatchEvent(new CustomEvent("location-changed")));else{var i=this._scrollPositionMap;null!=t&&null!=t.page&&(i[t.page]=window.pageYOffset),this.page=e.page,null!=i[e.page]?Polymer.AppLayout.scroll({top:i[e.page],behavior:"silent"}):this.isAttached&&Polymer.AppLayout.scroll({top:0,behavior:"silent"})}}},_pageChanged:function(e,t){var o;(console.log("Page changed to "+e),e)&&(o="view-404"==e?this.resolveUrl("yp-view-404.html?v=8.0.0-4"):this.resolveUrl("../yp-"+e+"/yp-"+e+".html?v=8.0.0-4"),console.log("Trying to load "+o),this.importHref(o,null,this._showPage404,!0));e&&window.appGlobals.sendToAnalyticsTrackers("send","pageview",location.pathname)},openResetPasswordDialog:function(e){this.getDialogAsync("resetPassword",function(t){t.open(e)}.bind(this))},openUserNotificationsDialog:function(){window.appUser&&!0===window.appUser.loggedIn()?window.appUser.openNotificationSettings():window.appUser.loginForNotificationSettings()},openAcceptInvitationDialog:function(e){this.getDialogAsync("acceptInvite",function(t){t.open(e)}.bind(this))},_showPage404:function(){this.page="view-404"},_setHomeLink:function(e,t){this.homeLink||this.set("homeLink",t)},setKeepOpenForPostsOn:function(e){this.set("keepOpenForPost",e),this.set("storedBackPath",this.backPath),this.set("storedLastDocumentTitle",document.title)},_closePost:function(){this.keepOpenForPost&&this.redirectTo(this.keepOpenForPost),this.storedBackPath&&this.set("backPath",this.storedBackPath),this.storedLastDocumentTitle&&(document.title=this.storedLastDocumentTitle,this.set("storedLastDocumentTitle",null)),this.set("this.keepOpenForPost",null),document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"yp-pause-media-playback",data:{}}}))},_closePostHeader:function(e,t){return!("post"!=e||!t)},_isGroupOpen:function(e,t){return!!(e.groupId||e.postId&&t)},_isCommunityOpen:function(e,t){return!!(e.communityId||e.postId&&t)},_isDomainOpen:function(e,t){return!!(e.domainId||e.postId&&t)},_toggleNavDrawer:function(){this.$$("#navDrawer").toggle()},ready:function(){Polymer.setPassiveTouchGestures(!0),window.app=this,this.setTheme(16)},getDialogAsync:function(e,t){this.$$("#dialogContainer").getDialogAsync(e,t)},getUsersGridAsync:function(e){this.$$("#dialogContainer").getUsersGridAsync(e)},closeDialog:function(e){this.$$("#dialogContainer").closeDialog(e)},_dialogClosed:function(e,t){this.$$("#dialogContainer").dialogClosed(t)},scrollPageToTop:function(){var e=document.getElementById("#mainArea");e&&(e.scroller.scrollTop=0)},_toggleUserDrawer:function(){this.$$("#drawer").toggle()},_login:function(){window.appUser&&window.appUser.openUserlogin()},onChangeHeader:function(e,t){this.set("headerTitle",document.title=t.headerTitle),this.async(function(){var e=this.$$("#headerTitle");if(e){var t=e.innerHTML.length;this.wide?e.style.fontSize="20px":e.style.fontSize=t<20?"17px":t<25?"14px":t<30?"13px":"12px"}}),t.documentTitle&&(document.title=t.documentTitle),this.set("headerDescription",t.headerDescription),t.enableSearch?this.showSearch=!0:this.showSearch=!1,!0===t.useHardBack?this.set("useHardBack",!0):this.set("useHardBack",!1),t.backPath?(this.set("showBack",!0),this.set("backPath",t.backPath)):(this.set("showBack",!1),this.set("backPath",null)),t.hideHelpIcon?this.set("hideHelpIcon",!0):this.set("hideHelpIcon",!1),this.showBack&&!0===t.disableDomainUpLink&&(this.set("showBack",!1),this.set("headerTitle",""))},goBack:function(e,t){this.backPath&&(this.useHardBack?(document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"yp-pause-media-playback",data:{}}})),window.location=this.backPath):this.redirectTo(this.backPath))},_onSearch:function(e){this.toggleSearch(),this.unshift("previousSearches",e.detail.value);var t=document.querySelector("#postsFilter");t&&t.searchFor(e.detail.value)},onUserChanged:function(e,t){t&&t.id?this.set("user",t):this.set("user",null)},toggleSearch:function(){this.$$("#search").toggle()},__equal:function(e,t){return e===t}});</script></dom-module>